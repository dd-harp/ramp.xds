<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ITN-based Vector Control â€¢ ramp.xds</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ITN-based Vector Control">
<meta property="og:description" content="ramp.xds">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ramp.xds</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/GettingStarted.html">Getting Started with ramp.xds</a>
    </li>
    <li>
      <a href="../articles/Working.html">Working with Models in ramp.xds</a>
    </li>
    <li>
      <a href="../articles/Understanding_ramp.xds.html">Understanding ramp.xds</a>
    </li>
    <li>
      <a href="../articles/modularity.html">Modular Forms for Disease Dynamics</a>
    </li>
    <li>
      <a href="../articles/ex_534.html">5-3-4 Spatial Example</a>
    </li>
    <li>
      <a href="../articles/spat_metric.html">Spatial Metrics</a>
    </li>
    <li>
      <a href="../articles/vc_lemenach.html">Vector Control Example</a>
    </li>
    <li>
      <a href="../articles/Contributing.html">Contributing</a>
    </li>
    <li>
      <a href="../articles/heterogeneous_transmission.html">Heterogeneous Transmission</a>
    </li>
    <li>
      <a href="../articles/heterogeneous_biting.html">Heterogeneous Biting</a>
    </li>
    <li>
      <a href="../articles/heterogeneous_mixing.html">Heterogeneous Mixing</a>
    </li>
    <li>
      <a href="../articles/environmental_heterogeneity.html">Environmental Heterogeneity</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Mosquito - Adult
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AdultMosquitoes.html">Adult Mosquitoes</a>
    </li>
    <li>
      <a href="../articles/adult_RM.html">Ross-Macdonald model</a>
    </li>
    <li>
      <a href="../articles/RM-dts-Mosquito.html">Ross-Macdonald, discrete time</a>
    </li>
    <li>
      <a href="../articles/adult_GeRM.html">Generalized Ross-Macdonald model</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Mosquito - Aquatic
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/aqua_trivial.html">Aquatic - Trivial (forced) model</a>
    </li>
    <li>
      <a href="../articles/aqua_basic.html">Basic Competition</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Human / Host
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/human_sis.html">SIS model</a>
    </li>
    <li>
      <a href="../articles/human_sip.html">SIP xde model</a>
    </li>
    <li>
      <a href="../articles/human_hmoi.html">MoI hybrid model</a>
    </li>
    <li>
      <a href="../articles/human_seis.html">SEIS model</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dd-harp/ramp.xds/" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ITN-based Vector Control</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/ramp.xds/blob/HEAD/vignettes/vc_lemenach.Rmd" class="external-link"><code>vignettes/vc_lemenach.Rmd</code></a></small>
      <div class="hidden name"><code>vc_lemenach.Rmd</code></div>

    </div>

    
    
<p>In this vignette we demonstrate how to set up a model incorporating
the Le Menach model of ITN based vector control (see <a href="https://malariajournal.biomedcentral.com/articles/10.1186/1475-2875-6-10" class="external-link">this
paper</a>). We use the Ross-Macdonald model of adult mosquito dynamics,
the SIS model of human population dynamics, and the basic competition
model of aquatic mosquito dynamics to fill the dynamical components
<span class="math inline">\(\mathcal{M}, \mathcal{X},
\mathcal{L}\)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dd-harp.github.io/ramp.xds/">ramp.xds</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://R-Forge.R-project.org/projects/expm/" class="external-link">expm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/" class="external-link">deSolve</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h2>
<p>This case study will use a simple model with 3 patches, 3 population
strata, and 3 aquatic habitats. As usual, we set up parameter values and
compute the values of state variables at equilibrium. As part of the
equilibrium calculation we must compute <span class="math inline">\(\Upsilon(0) = \exp\left(-\int_{-\tau}^{0}
\Omega(s) ds \right)\)</span>; the value of the integrated mosquito
demography matrix at the initial time point. To simplify things, we
simply assume that conditions were constant prior to <span class="math inline">\(t=0\)</span> so that <span class="math inline">\(\Upsilon(0) = e^{-\Omega\tau}\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nPatches</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">nStrata</span> <span class="op">&lt;-</span> <span class="va">nPatches</span></span>
<span><span class="va">nHabitats</span> <span class="op">&lt;-</span> <span class="va">nPatches</span></span>
<span><span class="va">residence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nStrata</span><span class="op">)</span></span>
<span><span class="va">membership</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">HPop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nPatches</span>, lambda <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># human parameters</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">0.55</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fl">0.15</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">200</span></span>
<span><span class="va">Xo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b<span class="op">=</span><span class="va">b</span>,c<span class="op">=</span><span class="va">c</span>,r<span class="op">=</span><span class="va">r</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">nStrata</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pfpr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nStrata</span>, min <span class="op">=</span> <span class="fl">0.25</span>, max <span class="op">=</span> <span class="fl">0.35</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nStrata</span>, size <span class="op">=</span> <span class="va">HPop</span>, prob <span class="op">=</span> <span class="va">pfpr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">searchWtsH</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">TaR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">0.9</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>,</span>
<span>    <span class="fl">0.05</span>, <span class="fl">0.9</span>, <span class="fl">0.05</span>,</span>
<span>    <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.9</span></span>
<span>  <span class="op">)</span>, nrow <span class="op">=</span> <span class="va">nStrata</span>, ncol <span class="op">=</span> <span class="va">nPatches</span>, byrow <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="va">TaR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">TaR</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="va">nPatches</span><span class="op">)</span> </span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">10</span>, <span class="va">nPatches</span><span class="op">)</span>  </span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nPatches</span><span class="op">)</span>  </span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">100</span>, <span class="va">nPatches</span><span class="op">)</span>  </span>
<span><span class="va">nu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, <span class="va">nPatches</span><span class="op">)</span>  </span>
<span><span class="va">eggsPerBatch</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">eip</span> <span class="op">&lt;-</span> <span class="fl">11</span></span>
<span><span class="va">MYZo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>f<span class="op">=</span><span class="va">f</span>, q<span class="op">=</span><span class="va">q</span>, g<span class="op">=</span><span class="va">g</span>, sigma<span class="op">=</span><span class="va">sigma</span>, mu<span class="op">=</span><span class="va">mu</span>, </span>
<span>            nu<span class="op">=</span><span class="va">nu</span>, eggsPerBatch<span class="op">=</span><span class="va">eggsPerBatch</span>, eip<span class="op">=</span><span class="va">eip</span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calK</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_calK_herethere.html">create_calK_herethere</a></span><span class="op">(</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="va">calK</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,]  0.0  0.5  0.5</span></span>
<span><span class="co">#&gt; [2,]  0.5  0.0  0.5</span></span>
<span><span class="co">#&gt; [3,]  0.5  0.5  0.0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="equilibrium">Equilibrium<a class="anchor" aria-label="anchor" href="#equilibrium"></a>
</h2>
<p>Now we compute the equilibrium conditions for the adult mosquitoes
and human populations, such that the PfPR in the human population would
be maintained at the input levels if conditions were unchanging.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># derived EIR to sustain equilibrium pfpr</span></span>
<span><span class="va">EIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">b</span>, <span class="va">nStrata</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="op">(</span><span class="va">r</span><span class="op">*</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">HPop</span> <span class="op">-</span> <span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ambient pop</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="va">TaR</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">HPop</span></span>
<span></span>
<span><span class="co"># biting distribution matrix</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">wf</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">TaR</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span>, <span class="va">nPatches</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># kappa</span></span>
<span><span class="va">kappa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">X</span><span class="op">*</span><span class="va">c</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Omega</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_Omega_xde.html">compute_Omega_xde</a></span><span class="op">(</span><span class="va">g</span>, <span class="va">sigma</span>, <span class="va">mu</span>, <span class="va">calK</span><span class="op">)</span></span>
<span><span class="va">Omega_inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">Omega</span><span class="op">)</span></span>
<span><span class="va">Upsilon</span> <span class="op">&lt;-</span> <span class="fu">expm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/expm/man/expm.html" class="external-link">expm</a></span><span class="op">(</span><span class="op">-</span><span class="va">Omega</span> <span class="op">*</span> <span class="va">eip</span><span class="op">)</span></span>
<span><span class="va">Upsilon_inv</span> <span class="op">&lt;-</span> <span class="fu">expm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/expm/man/expm.html" class="external-link">expm</a></span><span class="op">(</span><span class="va">Omega</span> <span class="op">*</span> <span class="va">eip</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># equilibrium solutions</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">f</span><span class="op">*</span><span class="va">q</span><span class="op">)</span>, <span class="va">nPatches</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/ginv.html" class="external-link">ginv</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">EIR</span></span>
<span><span class="va">MY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">f</span><span class="op">*</span><span class="va">q</span><span class="op">*</span><span class="va">kappa</span><span class="op">)</span>, <span class="va">nPatches</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Upsilon_inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Omega</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Z</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">Omega_inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">f</span><span class="op">*</span><span class="va">q</span><span class="op">*</span><span class="va">kappa</span><span class="op">)</span>, <span class="va">nPatches</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">MY</span><span class="op">)</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="va">MY</span> <span class="op">+</span> <span class="va">Y</span></span>
<span><span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">nPatches</span><span class="op">)</span> <span class="op">+</span> <span class="va">Omega</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">nPatches</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">M</span></span>
<span><span class="va">Lambda</span> <span class="op">&lt;-</span> <span class="va">Omega</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">M</span></span></code></pre></div>
<p>Given the equilibrium value of <span class="math inline">\(\Lambda\)</span> required to sustain mosquito
populations at such a level sufficient to maintain transmission at that
level of PfPR, as well as values for <span class="math inline">\(\psi\)</span> (maturation rate) and <span class="math inline">\(\phi\)</span> (density independent mortality), we
compute equilibrium values of <span class="math inline">\(L\)</span>
(aquatic mosquito density) and <span class="math inline">\(\theta\)</span> (density dependent mortality).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># aquatic habitat membership matrix (assume 1 habitat per patch)</span></span>
<span><span class="va">calN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nPatches</span>, <span class="va">nHabitats</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">calN</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># egg dispersal matrix (assume 1 habitat per patch)</span></span>
<span><span class="va">calU</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nHabitats</span>, <span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">calU</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">psi</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">10</span></span>
<span><span class="va">phi</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">12</span></span>
<span><span class="va">eta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">calU</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">M</span> <span class="op">*</span> <span class="va">nu</span> <span class="op">*</span> <span class="va">eggsPerBatch</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">calN</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Lambda</span><span class="op">)</span></span>
<span><span class="va">L</span> <span class="op">&lt;-</span> <span class="va">alpha</span><span class="op">/</span><span class="va">psi</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">eta</span> <span class="op">-</span> <span class="va">psi</span><span class="op">*</span><span class="va">L</span> <span class="op">-</span> <span class="va">phi</span><span class="op">*</span><span class="va">L</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">L</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Now that all state variables have been solved at equilibrium, we can
set up the parameters and components of the system.</p>
<p>We use the null model of human demographic dynamics, which assumes
<span class="math inline">\(H\)</span> is constant for all time.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># adult mosquito parameters</span></span>
<span></span>
<span><span class="va">Lo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>psi<span class="op">=</span><span class="va">psi</span>, phi<span class="op">=</span><span class="va">phi</span>, theta<span class="op">=</span><span class="va">theta</span>, L<span class="op">=</span><span class="va">L</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MYZo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>f<span class="op">=</span><span class="va">f</span>, q<span class="op">=</span><span class="va">q</span>, g<span class="op">=</span><span class="va">g</span>, sigma<span class="op">=</span><span class="va">sigma</span>, </span>
<span>            nu<span class="op">=</span><span class="va">nu</span>, eggsPerBatch<span class="op">=</span><span class="va">eggsPerBatch</span>, </span>
<span>            M<span class="op">=</span><span class="va">M</span>, P<span class="op">=</span><span class="va">P</span>, Y<span class="op">=</span><span class="va">Y</span>, Z<span class="op">=</span><span class="va">Z</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/xds_setup.html">xds_setup</a></span><span class="op">(</span>MYZname<span class="op">=</span><span class="st">"si"</span>, Xname<span class="op">=</span><span class="st">"SIS"</span>, Lname<span class="op">=</span><span class="st">"basicL"</span>, </span>
<span>          nPatches<span class="op">=</span><span class="fl">3</span>, HPop<span class="op">=</span><span class="va">HPop</span>, membership<span class="op">=</span><span class="va">membership</span>, </span>
<span>          MYZopts<span class="op">=</span><span class="va">MYZo</span>, calK<span class="op">=</span><span class="va">calK</span>,</span>
<span>          Xopts<span class="op">=</span><span class="va">Xo</span>, residence<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, searchB<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>          TimeSpent <span class="op">=</span><span class="va">TaR</span>, searchQ<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, Lopts<span class="op">=</span><span class="va">Lo</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">itn_mod</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">itn_mod</span><span class="op">$</span><span class="va">MYZpar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">effect_sizes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"modified"</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">itn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VectorControlEffectSizes.html">VectorControlEffectSizes</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="va">itn_mod</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">itn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xde_solve.html">xde_solve</a></span><span class="op">(</span><span class="va">itn_mod</span>, <span class="fl">1830</span>, dt<span class="op">=</span><span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">itn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/last_to_inits.html">last_to_inits</a></span><span class="op">(</span><span class="va">itn_mod</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">itn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_forcing.html">setup_forcing</a></span><span class="op">(</span><span class="va">itn_mod</span><span class="op">)</span></span>
<span><span class="va">itn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_control_forced.html">setup_control_forced</a></span><span class="op">(</span><span class="va">itn_mod</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">itn_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_vc_control.html">setup_vc_control</a></span><span class="op">(</span><span class="va">itn_mod</span><span class="op">)</span></span></code></pre></div>
<p>If we ran the model at this point, we would get the baseline.
Instead, we set up a time-varying function to compute the coverage of
ITNs at any time point. We use a sine curve with a period of 365 days
which goes from 0 to 1 over that period, with the phase shifted so that
at 0 it returns 0. The function also returns 0 for any <span class="math inline">\(t&lt;0\)</span>. This must be a function that
takes a single argument <code>t</code> (time) and returns a scalar
value.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ITN coverage</span></span>
<span><span class="va">ITN_cov</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">pars</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="op">(</span><span class="va">t</span><span class="op">-</span><span class="fl">365</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="op">/</span> <span class="fl">365</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1830</span>, by <span class="op">=</span> <span class="fl">15</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tt</span>, <span class="fu">ITN_cov</span><span class="op">(</span><span class="va">tt</span>, <span class="va">itn_mod</span><span class="op">)</span>, type <span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vc_lemenach_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>We use the null model of human demographic dynamics, which assumes
<span class="math inline">\(H\)</span> is constant for all time.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">itn_mod</span><span class="op">$</span><span class="va">forcing</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"dynamic"</span></span>
<span><span class="va">itn_mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/setup_itn_lemenach.html">setup_itn_lemenach</a></span><span class="op">(</span><span class="va">itn_mod</span>, F_phi<span class="op">=</span><span class="va">ITN_cov</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/xde_solve.html">xde_solve</a></span><span class="op">(</span><span class="va">itn_mod</span>, <span class="fl">1830</span>, dt<span class="op">=</span><span class="fl">15</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">itn_mod</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">itn_mod</span><span class="op">$</span><span class="va">outputs</span>,<span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">itn_mod</span><span class="op">$</span><span class="va">outputs</span><span class="op">$</span><span class="va">orbits</span><span class="op">$</span><span class="va">MYZ</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">Z</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">Z</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">Z</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">itn_mod</span><span class="op">$</span><span class="va">outputs</span><span class="op">$</span><span class="va">orbits</span><span class="op">$</span><span class="va">X</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">I</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">I</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">I</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">itn_mod</span><span class="op">$</span><span class="va">outputs</span><span class="op">$</span><span class="va">terms</span>,<span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">EIR</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">EIR</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">EIR</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="vc_lemenach_files/figure-html/unnamed-chunk-22-1.png" width="768"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
