<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nimble Model Building â€¢ ramp.xds</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Nimble Model Building">
<meta property="og:description" content="ramp.xds">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ramp.xds</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/GettingStarted.html">Getting Started with ramp.xds</a>
    </li>
    <li>
      <a href="../articles/Working.html">Working with Models in ramp.xds</a>
    </li>
    <li>
      <a href="../articles/TraceFunctions.html">Trace Functions</a>
    </li>
    <li>
      <a href="../articles/Understanding_ramp.xds.html">Understanding ramp.xds</a>
    </li>
    <li>
      <a href="../articles/modular_forms.html">Modular Forms for Disease Dynamics</a>
    </li>
    <li>
      <a href="../articles/ex_534.html">5-3-4 Spatial Example</a>
    </li>
    <li>
      <a href="../articles/spat_metric.html">Spatial Metrics</a>
    </li>
    <li>
      <a href="../articles/vc_lemenach.html">Vector Control Example</a>
    </li>
    <li>
      <a href="../articles/heterogeneous_transmission.html">Heterogeneous Transmission</a>
    </li>
    <li>
      <a href="../articles/Nimble.html">Nimble Model Building and Scaling Complexity</a>
    </li>
    <li>
      <a href="../articles/Contributing.html">Contributing</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Mosquito - Adult
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AdultMosquitoes.html">Adult Mosquitoes</a>
    </li>
    <li>
      <a href="../articles/adult_RM.html">Ross-Macdonald model</a>
    </li>
    <li>
      <a href="../articles/RM-dts-Mosquito.html">Ross-Macdonald, discrete time</a>
    </li>
    <li>
      <a href="../articles/adult_GeRM.html">Generalized Ross-Macdonald model</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Mosquito - Aquatic
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/aqua_trace.html">Aquatic - Trivial (forced) model</a>
    </li>
    <li>
      <a href="../articles/aqua_basic.html">Basic Competition</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Human / Host
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/human_sis.html">SIS model</a>
    </li>
    <li>
      <a href="../articles/human_sip.html">SIP xde model</a>
    </li>
    <li>
      <a href="../articles/human_hmoi.html">MoI hybrid model</a>
    </li>
    <li>
      <a href="../articles/human_seis.html">SEIS model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dd-harp/ramp.xds/" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Nimble Model Building</h1>
            <h3 data-toc-skip class="subtitle">Modular Dynamical Systems
&amp; Computatation for Malaria &amp; Other Mosquito-Transmitted
Pathogens</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/ramp.xds/blob/HEAD/vignettes/modularity.Rmd" class="external-link"><code>vignettes/modularity.Rmd</code></a></small>
      <div class="hidden name"><code>modularity.Rmd</code></div>

    </div>

    
    
<p>This software supports nimble model building with functions to set
up, solve, and analyze dynamical systems models for mosquito ecology and
mosquito-borne pathogen transmission formulated as dynamical systems in
continuous or discrete time. The systems are naturally modular: an
intermediate step in developing a model for
<strong><code>ramp.xds</code></strong> is to rewrite the equations using
<a href="https://dd-harp.github.io/ramp.xds/articles/modularity.html">Modular
Forms</a>.</p>
<p>The mathematical framework and software have a modular design
developed around an algorithm to model mosquito blood feeding on
vertebrate hosts and parasite / pathogen transmission, including
patch-based spatial dynamics within a defined geographical domain. The
blood feeding algorithm provides a rigorous computational interface
linking dynamical components describing parasite/pathogen linking
infection dynamics in mosquito and vertebrate host populations. It
guarantees mathematical consistency in computing blood feeding rates and
habits and in allocating bites and blood meals with heterogeneous
vertebrate host population densities, including models with dynamically
changing availability of host populations or other vertebrate
animals.</p>
<p>The framework and software also support spatial models of mosquito
ecology through an algorithm that describes egg laying by adult
mosquitoes in aquatic habitats and emergence of adult mosquitoes. The
egg laying algorithm provides a rigorous interface linking dynamical
components describing adult mosquito populations in a set of spatial
patches and immature aquatic mosquito populations in a structured set of
aquatic habitats.</p>
<div class="section level2">
<h2 id="modularity">Modularity<a class="anchor" aria-label="anchor" href="#modularity"></a>
</h2>
<p>Dynamical systems models for malaria and other mosquito-borne
pathogens (MBPs) are naturally modular. Transmission dynamics involve
infection dynamics in populations of two different species of hosts: a
mosquito host, and a human or other vertebrate animal host. Parasite /
pathogen transmission occurs through blood feeding. The modular nature
of these systems can be emphasized by rewriting the equations using <a href="modular_forms.html">modular forms</a></p>
<p>Mosquito population density is a parameter in the Ross-Macdonald
model. Many dynamical systems describing transmission dynamics and
control for malaria and other MBPs include equations describing mosquito
ecology and population dynamics: volant adult and aquatic immature
mosquito sub-populations connected through egg-laying and emergence. The
equations describing these dynamics can be organized around blood
feeding (for transmission) or egg-laying and emergence (for mosquito
ecology).</p>
<p>In simple models, the assumptions about</p>
<hr>
<div class="float">
<img src="modularity.png" alt="Figure 1 A diagram of the core components in dynamical systems models of malaria: \cal L"><div class="figcaption">
<strong>Figure 1</strong> A diagram of the core
components in dynamical systems models of malaria: <span class="math inline">\(\cal L\)</span>
</div>
</div>
<hr>
<p>Dynamical systems for malaria and other MBPs have a broad set of
other features: spatial dynamics; human/host demography; heterogeneous
transmission; various forms of vector control; health interventions;
mosquito resource dynamics; malaria importation; and exogenous forcing
by weather.</p>
<hr>
<div class="float">
<img src="ModularGeneralized.png" alt="Modularity"><div class="figcaption">Modularity</div>
</div>
<div class="float">
<img src="RossMacdonald3b.png" alt="Ross"><div class="figcaption">Ross</div>
</div>
<p>In <code>ramp.xds,</code> the equations are solved by computing the
terms and the derivatives separately.</p>
<ul>
<li>
<p><code>Transmission(t,y,pars)</code> computes three terms required
to compute parasite transmission during blood feeding. These are stored
in the main model object <code>pars</code>:</p>
<ul>
<li><p><code>pars$beta</code> - a function that allocates infective
bites to human strata. In this case, <span class="math inline">\(\beta =
1/H\)</span></p></li>
<li><p><code>pars$NI</code> - a function <span class="math inline">\(F_X\)</span> computes the effective density. In
this case, <span class="math inline">\(F_X\)</span> returns <span class="math inline">\(cI\)</span></p></li>
<li><p><code>pars$fqZ</code> - a function <span class="math inline">\(F_fqZ\)</span> computes infective biting
density</p></li>
<li><p><code>pars$EIR</code> - the daily EIR is <span class="math inline">\(\beta \cdot fqZ\)</span></p></li>
<li><p><code>pars$FoI</code> - the daily FoI is <span class="math inline">\(F_h(EIR, b, pars\)</span>Xpar)$</p></li>
</ul>
</li>
<li><p><code>Exposure(t, y, pars)</code> computes the FoI from the EIR
under a model of exposure and stores it as
<code>pars$FoI</code></p></li>
</ul>
<p>So instead of developing models like <code>RMv1</code>, we have
implemented the code in the syle of <code>RMv2</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RMv2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span>,<span class="op">{</span></span>
<span>      <span class="va">pars</span> <span class="op">=</span> <span class="fu"><a href="../reference/Transmission.html">Transmission</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span></span>
<span>      <span class="va">pars</span> <span class="op">=</span> <span class="fu"><a href="../reference/Exposure.html">Exposure</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span></span>
<span>      <span class="va">dX</span> <span class="op">=</span> <span class="fu"><a href="../reference/dXdt.html">dXdt</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span> </span>
<span>      <span class="va">dY</span> <span class="op">=</span> <span class="fu"><a href="../reference/dMYZdt.html">dMYZdt</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span> </span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">dX</span>, <span class="va">dY</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-building-in-ramp-xds">Model building in ramp.xds<a class="anchor" aria-label="anchor" href="#model-building-in-ramp-xds"></a>
</h2>
<p>Models for mosquito borne pathogen transmission systems are naturally
modular, structured by vector life stage, host population strata, and by
the spatial locations (patches) at which transmission occurs (see figure
below).</p>
<p align="center">
<img src="modularity.png">&gt;
</p>
<p>Models in the ramp.xds framework are constructed from 3 dynamical
components:</p>
<ul>
<li>
<span class="math inline">\(\mathcal M\)</span>: adult mosquitoes,
whose dynamics are described by <span class="math inline">\(d\mathcal{M}/dt\)</span>
</li>
<li>
<span class="math inline">\(\mathcal{L}\)</span>: aquatic (immature)
mosquitoes, whose dynamics are described by <span class="math inline">\(d\mathcal{L}/dt\)</span>
</li>
<li>
<span class="math inline">\(\mathcal{X}\)</span>: human population,
whose dynamics are described by <span class="math inline">\(d\mathcal{X}/dt\)</span>
</li>
</ul>
<p>The combined state from these 3 components is the entire state of the
dynamical model, and their combined dynamics described by their
differential equations represents the full endogenous dynamics of the
system. In addition there are 2 more components which do not directly
contribute to the state of the model, but instead modify parameters and
compute intermediate quantities to represent external influences on the
system. These are:</p>
<ul>
<li>Exogenous forcing: weather, climate, unmodeled populations</li>
<li>Vector control: public health and mosquito control interventions
which affect the dynamical components</li>
</ul>
<p>There are also functions which handle the exchange of information
(flows) between the dynamical components and which couple their
dynamics. Bloodfeeding is the process by which adult mosquitoes seek out
and feed on blood hosts, and results in the quantities <span class="math inline">\(EIR\)</span> (entomological inoculation rate) and
<span class="math inline">\(\kappa\)</span>, the net infectiousness of
humans to mosquitoes, which couple the dynamics of <span class="math inline">\(\mathcal{M}\)</span> and <span class="math inline">\(\mathcal{X}\)</span>. Likewise emergence of new
adults from aquatic habitats and egg laying by adults into habitats
couples <span class="math inline">\(\mathcal{M}\)</span> and <span class="math inline">\(\mathcal{L}\)</span>.</p>
<p>The function <code><a href="../reference/xde_derivatives.html">ramp.xds::xde_derivatives</a></code> compute the
necessary quantities and returns a vector of derivatives of all state
variables which can be used to solve trajectories from a model in
ramp.xds. The program flow within this function is summarized by this
diagram:</p>
<p align="center">
<img src="xDEdiffeqn.png"></p>
<p>For more information, please read our <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1010684" class="external-link">research
article</a> describing the theory behind the model.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
