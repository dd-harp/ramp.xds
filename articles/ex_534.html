<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5-3-4 Example • ramp.xds</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="5-3-4 Example">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ramp.xds</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.98</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/adult_RM.html">A Ross-Macdonald Adult Mosquito Model</a></li>
    <li><a class="dropdown-item" href="../articles/AdultMosquitoes.html">Adult Mosquito Models</a></li>
    <li><a class="dropdown-item" href="../articles/aqua_basic.html">basicL_xde Competition Aquatic Mosquito Model</a></li>
    <li><a class="dropdown-item" href="../articles/aqua_trace.html">Trace (exogenously forced) Aquatic Mosquito Model</a></li>
    <li><a class="dropdown-item" href="../articles/BedNets.html">Bed Nets</a></li>
    <li><a class="dropdown-item" href="../articles/Contributing.html">Contributing</a></li>
    <li><a class="dropdown-item" href="../articles/ex_534.html">5-3-4 Example</a></li>
    <li><a class="dropdown-item" href="../articles/Forcing.html">Exogenous Forcing</a></li>
    <li><a class="dropdown-item" href="../articles/GettingStarted.html">Getting Started with `ramp.xds`</a></li>
    <li><a class="dropdown-item" href="../articles/heterogeneous_biting.html">Heterogeneous Biting</a></li>
    <li><a class="dropdown-item" href="../articles/heterogeneous_transmission.html">Heterogeneous Transmission</a></li>
    <li><a class="dropdown-item" href="../articles/History.html">RAMP Software: A History</a></li>
    <li><a class="dropdown-item" href="../articles/human_hmoi.html">Hybrid MoI (Multiplicity of Infection) Human Model</a></li>
    <li><a class="dropdown-item" href="../articles/human_seis.html">SEIS and SEISd</a></li>
    <li><a class="dropdown-item" href="../articles/human_sip.html">SIP_xde (Susceptible-Infected-Prophylaxis) Human Model</a></li>
    <li><a class="dropdown-item" href="../articles/human_sis.html">SIS-xde (Susceptible-Infected-Susceptible) Human Model</a></li>
    <li><a class="dropdown-item" href="../articles/modular_forms.html">Modular Forms for Disease Dynamics</a></li>
    <li><a class="dropdown-item" href="../articles/modularity.html">Nimble Model Building</a></li>
    <li><a class="dropdown-item" href="../articles/Nimble.html">Nimble Model Building and Scalable Complexity</a></li>
    <li><a class="dropdown-item" href="../articles/RM-dts-Mosquito.html">Basic Mosquito Infection Dynamics in Discrete Time</a></li>
    <li><a class="dropdown-item" href="../articles/spat_metric.html">Spatial Metrics</a></li>
    <li><a class="dropdown-item" href="../articles/TraceFunctions.html">Trace Functions</a></li>
    <li><a class="dropdown-item" href="../articles/Understanding_ramp.xds.html">Understanding ramp.xds</a></li>
    <li><a class="dropdown-item" href="../articles/vc_lemenach.html">ITN-based Vector Control</a></li>
    <li><a class="dropdown-item" href="../articles/VectorControl.html">Vector Control</a></li>
    <li><a class="dropdown-item" href="../articles/Working.html">Working with Models in `ramp.xds`</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dd-harp/ramp.xds/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>5-3-4 Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/ramp.xds/blob/main/vignettes/ex_534.Rmd" class="external-link"><code>vignettes/ex_534.Rmd</code></a></small>
      <div class="d-none name"><code>ex_534.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dd-harp.github.io/ramp.xds/" class="external-link">ramp.xds</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://R-Forge.R-project.org/projects/expm/" class="external-link">expm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/" class="external-link">deSolve</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette illustrates how to setup, solve, and analyze models of
mosquito-borne pathogen transmission dynamics and control using modular
software. It serves several purposes:</p>
<ul>
<li>Modular notation is illustrated by constructing a model with five
aquatic habitats
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mi>q</mi></msub><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">n_q=5</annotation></semantics></math>),
three patches
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mi>p</mi></msub><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">n_p=3</annotation></semantics></math>),
and four human population strata
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mi>h</mi></msub><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">n_h=4</annotation></semantics></math>).
We call it <code>5-3-4</code>.</li>
</ul>
<div class="section level3">
<h3 id="diagram">Diagram<a class="anchor" aria-label="anchor" href="#diagram"></a>
</h3>
<p>The model <code>5-3-4</code> is designed to illustrate some important
features of the framework and notation. We assume that:</p>
<ul>
<li><p>the first three habitats are found in patch 1; the last two are
in patch 2; patch 3 has no habitats.</p></li>
<li><p>patch 1 has no residents; patches 2 and 3 are occupied, each with
two different population strata;</p></li>
<li><p>Transmission among patches is modeled using the concept of
<em>time spent</em>, which is similar to the <em>visitation rates</em>
that have been used in other models. While the strata have a residency
(i.e; a patch they spend most of their time in), each stratum allocates
their time across all the habitats.</p></li>
</ul>
<p><img src="534.png"></p>
</div>
<div class="section level3">
<h3 id="encoding-structural-information">Encoding Structural Information<a class="anchor" aria-label="anchor" href="#encoding-structural-information"></a>
</h3>
<p>Basic location information can be encoded in vectors. One vector,
called the habitat membership vector or <code>membership</code>, holds
information about the location of habitats. Another vector, called<br>
the strata residency vector or <code>residence</code>, encodes the
information about where people live.</p>
<p>For the aquatic habitats, the habitat membership vector is an ordered
list of the index of patches where the habitats are found:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">membership</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">membership</span></span>
<span><span class="co">#&gt; [1] 1 1 1 2 2</span></span></code></pre></div>
<p>The number of habitats,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>q</mi></msub><annotation encoding="application/x-tex">n_q</annotation></semantics></math>
or <code>nHabitats</code>, is the length of the membership matrix:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nHabitats</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">membership</span><span class="op">)</span></span>
<span><span class="va">nHabitats</span></span>
<span><span class="co">#&gt; [1] 5</span></span></code></pre></div>
<p>For the human population strata, the residence vector is an ordered
list of the index of patches where people live:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">residence</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">residence</span></span>
<span><span class="co">#&gt; [1] 2 2 3 3</span></span></code></pre></div>
<p>The number of strata,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>h</mi></msub><annotation encoding="application/x-tex">n_h</annotation></semantics></math>
or <code>nStrata</code>, is the length of the residence matrix:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nStrata</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">residence</span><span class="op">)</span></span>
<span><span class="va">nStrata</span></span>
<span><span class="co">#&gt; [1] 4</span></span></code></pre></div>
<p>The number of patches,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>p</mi></msub><annotation encoding="application/x-tex">n_p</annotation></semantics></math>
or <code>nPatches</code>, is just a number:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nPatches</span> <span class="op">=</span> <span class="fl">3</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="aquatic-habitat-membership-matrix">Aquatic Habitat Membership Matrix<a class="anchor" aria-label="anchor" href="#aquatic-habitat-membership-matrix"></a>
</h3>
<p>For computation, <code>ramp.xds</code> uses an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mi>p</mi></msub><mo>×</mo><msub><mi>n</mi><mi>q</mi></msub></mrow><annotation encoding="application/x-tex">n_p \times n_q</annotation></semantics></math>
matrix called <span class="math inline">$\cal{N}.$</span> It is
specified by the habitat vector. In the matrix, <span class="math inline">${\cal N}_{i,j}$</span> is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>
if the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">i^{th}</annotation></semantics></math>
patch contains the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>j</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">j^{th}</annotation></semantics></math>
habitat:</p>
<p><span class="math display">$$\begin{equation}
{\cal N} = \left[
\begin{array}{ccccc}
1 &amp; 1 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 &amp; 1\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
\end{array} \right]
\end{equation}$$</span></p>
<p>The matrix is created by a function
<code>create_habitat_matrix</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">habitat_matrix</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_habitat_matrix.html">create_habitat_matrix</a></span><span class="op">(</span><span class="va">nPatches</span>, <span class="va">membership</span><span class="op">)</span></span>
<span><span class="va">habitat_matrix</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]    1    1    1    0    0</span></span>
<span><span class="co">#&gt; [2,]    0    0    0    1    1</span></span>
<span><span class="co">#&gt; [3,]    0    0    0    0    0</span></span></code></pre></div>
<p>The habitat matrix is used to sum quantities in habitats up to
patches. For example, the number of habitats per patch is <span class="math inline">${\cal N} \cdot 1$</span>, where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>
is a vector of 1’s:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">habitat_matrix</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 3 2 0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-residence-matrix">The Residence Matrix<a class="anchor" aria-label="anchor" href="#the-residence-matrix"></a>
</h3>
<p>For computation, <code>ramp.xds</code> also creates a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mi>p</mi></msub><mo>×</mo><msub><mi>n</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">n_p \times n_h</annotation></semantics></math>
matrix called <span class="math inline">$\cal J.$</span> It is specified
by residence vector. The element <span class="math inline">${\cal
J}_{i,j}$</span> is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>
if the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>j</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">j^{th}</annotation></semantics></math>
stratum resides in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">i^{th}</annotation></semantics></math>
patch:</p>
<p><span class="math display">$$\begin{equation}
{\cal J} = \left[
\begin{array}{cccc}
0 &amp; 0 &amp; 0 &amp; 0 \\
1 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 1 \\
\end{array} \right]
\end{equation}$$</span></p>
<p>The matrix is created by a function
<code>create_residence_matrix</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">residence_matrix</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_residence_matrix.html">create_residence_matrix</a></span><span class="op">(</span><span class="va">nPatches</span>, <span class="va">residence</span><span class="op">)</span></span>
<span><span class="va">residence_matrix</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]    0    0    0    0</span></span>
<span><span class="co">#&gt; [2,]    1    1    0    0</span></span>
<span><span class="co">#&gt; [3,]    0    0    1    1</span></span></code></pre></div>
<p>The number of strata per patch is:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">residence_matrix</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 0 2 2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="egg-laying">Egg Laying<a class="anchor" aria-label="anchor" href="#egg-laying"></a>
</h3>
<p>It is plausible that these habitats are not all found with the same
propensity. Habitats are found after a search, and that search begins
after mosquitoes have blood fed. To compute egg distribution, we create
a vector describing habitat <em>search weights,</em> denoted
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ω</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">\omega.</annotation></semantics></math>
The proportion of eggs laid in each patch is it’s search weight as a
proportion of summed search weights of all habitats in a patch, a
quantity that we have called <em>availability,</em>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Q</mi><annotation encoding="application/x-tex">Q</annotation></semantics></math>.</p>
<p>For now, we generate arbitary weights for each one of the
habitats:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">searchWtsQ</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">8</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">searchWtsQ</span></span>
<span><span class="co">#&gt; [1] 7 2 1 8 2</span></span></code></pre></div>
<p>And we can compute availability as <span class="math inline">$\cal N
\cdot w$</span>. In <code>ramp.xds</code>, the function that computes
habitat availability is called <code>compute_Q</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_Q.html">compute_Q</a></span><span class="op">(</span><span class="va">habitat_matrix</span>, <span class="va">searchWtsQ</span><span class="op">)</span></span>
<span><span class="va">Q</span></span>
<span><span class="co">#&gt; [1] 10 10  0</span></span></code></pre></div>
<p>Eggs are distributed among habitats in proportion to the relative
values of the habitat search weights. These habitat search weights and
availability can be used to compute the values of some adult mosquito
bionomic parameters using <em>functional responses,</em> that make use
of their absolute values. The absolute values only have a meaning
through their effects.</p>
<p>The egg dispersal matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝒰</mi><annotation encoding="application/x-tex">\mathcal{U}</annotation></semantics></math>
is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mi>q</mi></msub><mo>×</mo><msub><mi>n</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">n_q \times n_p</annotation></semantics></math>
matrix describing how eggs laid by adult mosquitoes in a patch are
allocated among the aquatic habitats in that patch. It is a matrix of
search weights normalized by availability:</p>
<p><span class="math display">$$\begin{equation}
{\cal U} = \left[
\begin{array}{ccccc}
.7 &amp; 0 &amp; 0\\
.2 &amp; 0 &amp; 0\\
.1 &amp; 0 &amp; 0\\
0 &amp; .8 &amp; 0\\
0 &amp; .2 &amp; 0\\
\end{array} \right]
\end{equation}$$</span></p>
<p>It is computed using the function <code>compute_calU</code> that
takes care of a problem that could arise from having empty patches, like
patch 3 in this model.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calU</span> <span class="op">=</span> <span class="fu"><a href="../reference/compute_calU.html">compute_calU</a></span><span class="op">(</span><span class="va">searchWtsQ</span>, <span class="va">habitat_matrix</span>, <span class="va">Q</span><span class="op">)</span></span>
<span><span class="va">calU</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,]  0.7  0.0    0</span></span>
<span><span class="co">#&gt; [2,]  0.2  0.0    0</span></span>
<span><span class="co">#&gt; [3,]  0.1  0.0    0</span></span>
<span><span class="co">#&gt; [4,]  0.0  0.8    0</span></span>
<span><span class="co">#&gt; [5,]  0.0  0.2    0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="blood-feeding">Blood Feeding<a class="anchor" aria-label="anchor" href="#blood-feeding"></a>
</h3>
<p>Blood feeding is an activity that involves mosquitoes and humans:
mosquitoes are searching for vertebrate hosts to feed on, and they find
and feed on humans and other vertebrate hosts. The blood feeding
constructs in <code>ramp.xds</code> translate this into a set of
algorithms. The host population can be subdivided into a set of strata,
and those humans spend time in the patches around home. Both humans and
mosquitoes have daily activity patterns, so that human time spent and
relative mosquito activity rates can change during the day. Time spent
is thus translated into <strong>time at risk.</strong> Like the
habitats, the availability of those hosts to blood feeding mosquitoes is
affected by a set of <em>search weights.</em></p>
<p>This model has four population strata with even search weights:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">searchWtsH</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>This size of each population stratum differs:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HPop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">90</span>, <span class="fl">100</span>, <span class="fl">900</span><span class="op">)</span></span></code></pre></div>
<p>The time spent matrix,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Θ</mi><annotation encoding="application/x-tex">\Theta</annotation></semantics></math>
is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mi>p</mi></msub><mo>×</mo><msub><mi>n</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">n_p \times n_h</annotation></semantics></math>
matrix. Each column describes how a human stratum allocates time among
patches.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Θ</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mn>0.01</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>.01</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>.001</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>.001</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0.95</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>.92</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>.04</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>.02</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>0.04</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>.02</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>.959</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>.929</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
\Theta = \left[
 \begin{array}{cccc}
 0.01 &amp; .01 &amp; .001 &amp; .001 \\ 
 0.95 &amp; .92 &amp; .04 &amp; .02 \\ 
 0.04 &amp; .02 &amp; .959 &amp; .929 \\
 \end{array}
 \right] 
\end{equation}</annotation></semantics></math></p>
<p>This model does not consider daily patterns in human or mosquito
activity, so time spent and time at risk are identical.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TaR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">0.01</span>,<span class="fl">0.001</span>,<span class="fl">0.001</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.95</span>,<span class="fl">.92</span>,<span class="fl">.04</span>,<span class="fl">.02</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.04</span>,<span class="fl">.02</span>,<span class="fl">.959</span>,<span class="fl">.929</span><span class="op">)</span><span class="op">)</span>, <span class="fl">4</span>, <span class="fl">3</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The availability of hosts is of time at risk and the population
density weighed by their search weights:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_W.html">compute_W</a></span><span class="op">(</span><span class="va">searchWtsH</span>, <span class="va">HPop</span>, <span class="va">TaR</span><span class="op">)</span></span>
<span><span class="va">W</span></span>
<span><span class="co">#&gt; [1]   2.0 114.3 934.2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="transmission">Transmission<a class="anchor" aria-label="anchor" href="#transmission"></a>
</h3>
<p>A mixing matrix,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>,
describes the expected proportion of each infective bite that would be
received be each population stratum.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compute_beta.html">compute_beta</a></span><span class="op">(</span><span class="va">HPop</span>, <span class="va">W</span>, <span class="va">searchWtsH</span>, <span class="va">TaR</span><span class="op">)</span></span>
<span><span class="co">#&gt;       [,1]         [,2]         [,3]</span></span>
<span><span class="co">#&gt; [1,] 5e-03 0.0083114611 4.281738e-05</span></span>
<span><span class="co">#&gt; [2,] 5e-03 0.0080489939 2.140869e-05</span></span>
<span><span class="co">#&gt; [3,] 5e-04 0.0003499563 1.026547e-03</span></span>
<span><span class="co">#&gt; [4,] 5e-04 0.0001749781 9.944337e-04</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="aquatic-mosquito-dynamics">Aquatic Mosquito Dynamics<a class="anchor" aria-label="anchor" href="#aquatic-mosquito-dynamics"></a>
</h3>
<p>For this simulation, we use the basic competition model of larval
dynamics called <code>basicL</code> (see more <a href="aqua_basic.html">here</a>). It requires specification of three
parameters,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ψ</mi><annotation encoding="application/x-tex">\psi</annotation></semantics></math>
(maturation rates),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
(density-independent mortality rates), and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
(density-dependent mortality terms), and initial conditions. The
function <code>ramp.xds::xde_make_Lpar_basicL</code> does basic checking
of the input parameters and returns a list with the correct class for
method dispatch. The returned list is attached to the main parameter
list with name <code>Lpar</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">8</span>, <span class="va">nHabitats</span><span class="op">)</span></span>
<span><span class="va">phi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">8</span>, <span class="va">nHabitats</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">20</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">40</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">Lpar</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_Lpar_basicL.html">create_Lpar_basicL</a></span><span class="op">(</span><span class="va">nHabitats</span>, psi<span class="op">=</span><span class="va">psi</span>, phi<span class="op">=</span><span class="va">phi</span>, theta <span class="op">=</span> <span class="va">theta</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adult-mosquito-dynamics">Adult Mosquito Dynamics<a class="anchor" aria-label="anchor" href="#adult-mosquito-dynamics"></a>
</h3>
<p>It also uses the Ross-Macdonald model (see more <a href="adult_RM.html">here</a>). Part of the specification of parameters
includes the construction of the mosquito dispersal matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝒦</mi><annotation encoding="application/x-tex">\mathcal{K}</annotation></semantics></math>,
and the mosquito demography matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ω</mi><annotation encoding="application/x-tex">\Omega</annotation></semantics></math>.
Like for the aquatic parameters, we use
<code>ramp.xds::make_parameters_MYZ_RM_ode</code> to check parameter
types and return a list with the correct class for method dispatch.</p>
<p>The parameter values are:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">12</span> </span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">12</span><span class="op">/</span><span class="fl">2</span> </span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">0</span> </span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span> </span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fl">0.9</span> </span>
<span><span class="va">nu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">0</span><span class="op">)</span>  </span>
<span><span class="va">eip</span> <span class="op">&lt;-</span> <span class="fl">12</span> </span>
<span><span class="va">eggsPerBatch</span> <span class="op">&lt;-</span> <span class="fl">30</span> </span></code></pre></div>
<p>We create a named list:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MYZo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>g<span class="op">=</span><span class="va">g</span>, sigma<span class="op">=</span><span class="va">sigma</span>, mu<span class="op">=</span><span class="va">mu</span>, f<span class="op">=</span><span class="va">f</span>, q<span class="op">=</span><span class="va">q</span>, nu<span class="op">=</span><span class="va">nu</span>, eip<span class="op">=</span><span class="va">eip</span>, eggsPerBatch<span class="op">=</span><span class="va">eggsPerBatch</span><span class="op">)</span></span></code></pre></div>
<p>Mosquito dispersal among the patches is described by a matrix, <span class="math inline">$\cal K.$</span> Each column in <span class="math inline">$\cal K$</span> describes the proportion of
emigrating mosquitoes that go to every other patch. The diagonal
elements are all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.6</span>, <span class="fl">.3</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="fl">0</span>, <span class="fl">.7</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.6</span>, <span class="fl">.4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We construct the demographic matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ω</mi><annotation encoding="application/x-tex">\Omega</annotation></semantics></math>
given by the formula <span class="math display">$$\Omega =
\mbox{diag}\left(g\right) - \left[\mbox{diag}\left(1-\mu\right) - {\cal
K} \right] \cdot \mbox{diag}\left(\sigma\right)$$</span> It is computed
by <code>compute_Omega_xde</code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Omega</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_Omega_xde.html">compute_Omega_xde</a></span><span class="op">(</span><span class="va">g</span>, <span class="va">sigma</span>, <span class="va">mu</span>, <span class="va">calK</span><span class="op">)</span></span></code></pre></div>
<p>Survival and dispersal through the EIP in this model, denoted
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Υ</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">\Upsilon,</annotation></semantics></math>
is computed using matrix exponentiation:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Upsilon</span> <span class="op">&lt;-</span> <span class="fu">expm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/expm/man/expm.html" class="external-link">expm</a></span><span class="op">(</span><span class="op">-</span><span class="va">Omega</span><span class="op">*</span><span class="va">eip</span><span class="op">)</span></span></code></pre></div>
<p>The function <code>xde_make_MYZpar_RM</code> can be used to construct
the adult mosquito model object, called <code>MYZpar.</code></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MYZpar</span> <span class="op">=</span> <span class="fu"><a href="../reference/create_MYZpar_macdonald.html">create_MYZpar_macdonald</a></span><span class="op">(</span><span class="va">nPatches</span>, <span class="va">MYZo</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">MYZpar</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"macdonald"</span></span></code></pre></div>
<p>The parameters are assigned to a list called <code>baseline</code> so
that it can be stored and used to compute the values of bionomic
parameters that have been modified by control.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">MYZpar</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "nPatches"     "eip"          "f"            "q"            "g"           </span></span>
<span><span class="co">#&gt;  [6] "sigma"        "mu"           "nu"           "eggsPerBatch" "calK"        </span></span>
<span><span class="co">#&gt; [11] "Omega"        "Upsilon"      "baseline"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="human-infection-dynamics">Human Infection Dynamics<a class="anchor" aria-label="anchor" href="#human-infection-dynamics"></a>
</h3>
<p>We use a static demographic model, which assumes a constant
population size (constant
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math>).</p>
<p>The 5-3-4 model uses the basic SIS (Susceptible-Infected-Susceptible)
model for the human component (see more <a href="human_sis.html">here</a>). It can be configured using
<code>ramp.xds::xde_make_Xpar_SIS.</code></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">200</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">0.55</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">.02</span>, <span class="fl">.1</span>, <span class="fl">.02</span><span class="op">)</span></span></code></pre></div>
<p>The model is configured and assigned the name <code>Xpar</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Xpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_Xpar_SIS.html">create_Xpar_SIS</a></span><span class="op">(</span><span class="va">nStrata</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">b</span>, <span class="va">r</span>, <span class="va">c</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="initial-conditions">Initial Conditions<a class="anchor" aria-label="anchor" href="#initial-conditions"></a>
</h3>
<p>To solve the model, each variable needs an initial value. For the
aquatic model:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Linits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  L <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">nHabitats</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For the adult mosquito model:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MYZinits</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  M <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">nPatches</span><span class="op">)</span>,</span>
<span>  P <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="va">nPatches</span><span class="op">)</span>,</span>
<span>  Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">nPatches</span><span class="op">)</span>,</span>
<span>  Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For the human model:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Xinits</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">*</span><span class="va">HPop</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-xds-template">The <code>xds</code> Template<a class="anchor" aria-label="anchor" href="#the-xds-template"></a>
</h3>
<p>To build a model, <code>ramp.xds</code> must create an template that
stores the information about the patches, habitats, and strata in a
rigid form. The functions that solve and analyze the systems of
differential equations are, like most computer programs, unforgiving. An
object describing a model that can be solved by <code>ramp.xds</code> is
called an <code>xds</code> object. <code>ramp.xds</code> supports nimble
model building for e<strong>x</strong>tensible
<strong>d</strong>ynamical <strong>s</strong>ystems, including
e<strong>x</strong>tensible systems of <strong>d</strong>ifferential
equations (<code>xde</code>), and
<strong>d</strong>iscrete-<strong>t</strong>ime <strong>s</strong>ystems
using difference equations (<code>dts</code>).</p>
<p>Since the software is designed to solve very complex systems, we will
need to create an object that <em>could</em> accommodate added realism
(<em>e.g.</em> vector control). The function
<code>make_xds_template</code> sets up a compound list in <code>R</code>
that is like a building that we anticipate modifying, with
<em>ports</em> and <em>junctions</em> ready. These capabilities that are
not needed by simple models. The software’s requires that some objects
are present to handle all that complexity. Since most users won’t want
to learn about the details, the software includes a function, called
<code>make_xds_template</code> that sets up the scaffolding for a model,
including many that are set to their <code>null</code> values (turned
off).</p>
<p>A user only needs to know how to encode the information and what
information to encode. The rest is handled by functions. It is helpful
for users to understand some of the notation and terms. The following
are set up in order by <code>make_xds_template</code>:</p>
<ul>
<li>
<p>the first required argument sets the value and class of
<code>xds</code></p>
<ul>
<li><p><code>xde</code> is for e<strong>x</strong>tensible systems of
<strong>d</strong>ifferential <strong>e</strong>quations</p></li>
<li><p><code>dts</code> is for not a
<strong>d</strong>iscrete-<strong>t</strong>ime
<strong>s</strong>ystems</p></li>
</ul>
</li>
<li>
<p>the second required arugment sets the value and class of
<code>frame</code> that dispatches <em>both</em> a setup function and a
class of <code>xde_derivatives</code> (for <code>xde</code> models) or a
class of <code>dts_update</code> (for <code>dts</code> models)</p>
<ul>
<li><p><code>full</code> tells us the model should configure and compute
all three dynamical components</p></li>
<li><p>Other options – <code>mosy</code>, <code>aquatic</code>,
<code>human</code>, and <code>cohort</code> – work on subsets of the
components, and while they could be configured using
<code>full</code></p></li>
</ul>
</li>
<li>
<p>the third required term sets the value of<code>dlay</code> that
dispatches <code>xds_solve</code></p>
<ul>
<li><p><code>ode</code> uses <code><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">deSolve::ode</a></code> for ordinary
differential equations,</p></li>
<li><p><code>dde</code> uses <code>deSolve:dde</code> for delay
differential equations</p></li>
</ul>
</li>
<li><p>the next three arguments are <code>nPatches</code> and
<code>membership</code> and <code>residence</code>, as explained
above.</p></li>
</ul>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_xds_template.html">make_xds_template</a></span><span class="op">(</span><span class="st">"dde"</span>, <span class="st">"full"</span>, <span class="va">nPatches</span>, <span class="va">membership</span>, <span class="va">residence</span><span class="op">)</span> </span></code></pre></div>
<p>After being set up:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">nHabitats</span>, <span class="va">params</span><span class="op">$</span><span class="va">nPatches</span>, <span class="va">params</span><span class="op">$</span><span class="va">nStrata</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5 3 4</span></span></code></pre></div>
<p>This was created by <code>make_xds_template</code> and stored as
<code>params$habitat_matrix</code></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span><span class="op">$</span><span class="va">habitat_matrix</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span><span class="co">#&gt; [1,]    1    1    1    0    0</span></span>
<span><span class="co">#&gt; [2,]    0    0    0    1    1</span></span>
<span><span class="co">#&gt; [3,]    0    0    0    0    0</span></span></code></pre></div>
<p>If we want to retrieve the membership matrix, we can call
<code>view_habitat_matrix</code></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/view_habitat_matrix.html">view_habitat_matrix</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span>
<span><span class="co">#&gt; $habitat_index</span></span>
<span><span class="co">#&gt; [1] 1 2 3 4 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $patch_membership</span></span>
<span><span class="co">#&gt; [1] 1 1 1 2 2</span></span></code></pre></div>
<p>The function <code>make_xds_template</code> was designed to create a
scaffolding. So <code>Q</code> and <code>calU</code> get created with
default values: Iall patches are assumed to have the same biting
weights.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span><span class="op">$</span><span class="va">vars</span><span class="op">$</span><span class="va">Q</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 3 2 0</span></span></code></pre></div>
<p>A little detail to note is that an <code>xds</code> object is
designed to handle multiple vector and multiple host species. The
function <code>make_xds_template</code> only sets up the first species.
Similarly, we can view the egg distribution matrix for the first
species:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span><span class="op">$</span><span class="va">calU</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;           [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,] 0.3333333  0.0    0</span></span>
<span><span class="co">#&gt; [2,] 0.3333333  0.0    0</span></span>
<span><span class="co">#&gt; [3,] 0.3333333  0.0    0</span></span>
<span><span class="co">#&gt; [4,] 0.0000000  0.5    0</span></span>
<span><span class="co">#&gt; [5,] 0.0000000  0.5    0</span></span></code></pre></div>
<p>While this is a reasonable way to start, we don’t want to get stuck
using the default values.</p>
<p>To make a modular system that works as expected, we need to adopt
some conventions for setting the values of parameters. This can create
challenges because after changing the <em>search weights,</em> we will
also need to update <em>habitat availability</em> and the <em>egg
distribution matrix.</em> Updating all of that by hand would be
cumbersome, so <code>ramp.xds</code> has adopted some conventions for
changing parameter values and then updating the objects that depend on
them.</p>
<div class="section level4">
<h4 id="building-the-object">Building the Object<a class="anchor" aria-label="anchor" href="#building-the-object"></a>
</h4>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span><span class="op">$</span><span class="va">Lpar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">params</span><span class="op">$</span><span class="va">Lpar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">Lpar</span> </span>
<span><span class="va">params</span><span class="op">$</span><span class="va">MYZpar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">params</span><span class="op">$</span><span class="va">MYZpar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">MYZpar</span> </span>
<span><span class="va">params</span><span class="op">$</span><span class="va">Xpar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">params</span><span class="op">$</span><span class="va">Xpar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">Xpar</span> </span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_Linits.html">make_Linits</a></span><span class="op">(</span><span class="va">params</span>, <span class="fl">1</span>, <span class="va">Linits</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_MYZinits.html">make_MYZinits</a></span><span class="op">(</span><span class="va">params</span>, <span class="fl">1</span>, <span class="va">MYZinits</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_Xinits.html">make_Xinits</a></span><span class="op">(</span><span class="va">params</span>, <span class="va">HPop</span>, <span class="fl">1</span>, <span class="va">Xinits</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_Hpar_static.html">setup_Hpar_static</a></span><span class="op">(</span><span class="va">params</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>After the parameters for <code>5-3-4</code> have been specified, we
can generate the indices for the model and attach them to the parameter
list.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_indices.html">make_indices</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="setting-parameter-values">Setting Parameter Values<a class="anchor" aria-label="anchor" href="#setting-parameter-values"></a>
</h4>
<p>To assign new values for the habitat search weights, we use a
function called <code>set_habitat_wts_static.</code> After setting the
values of the habitat search weights, we need to update habitat
availability and the egg distribution matrix. The functions
<code>makeQ</code> and <code>make_calU</code> do this.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/change_habitat_weights.html">change_habitat_weights</a></span><span class="op">(</span><span class="va">params</span>, <span class="va">searchWtsQ</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_Q.html">make_Q</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_calU.html">make_calU</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<p>We can check to see</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span><span class="op">$</span><span class="va">vars</span><span class="op">$</span><span class="va">Q</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 10 10  0</span></span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span><span class="op">$</span><span class="va">calU</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,]  0.7  0.0    0</span></span>
<span><span class="co">#&gt; [2,]  0.2  0.0    0</span></span>
<span><span class="co">#&gt; [3,]  0.1  0.0    0</span></span>
<span><span class="co">#&gt; [4,]  0.0  0.8    0</span></span>
<span><span class="co">#&gt; [5,]  0.0  0.2    0</span></span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/change_TimeSpent.html">change_TimeSpent</a></span><span class="op">(</span><span class="va">TaR</span>, <span class="va">params</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_TaR.html">make_TaR</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span><span class="op">$</span><span class="va">TimeSpent</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;      [,1] [,2]  [,3]  [,4]</span></span>
<span><span class="co">#&gt; [1,] 0.01 0.01 0.001 0.001</span></span>
<span><span class="co">#&gt; [2,] 0.95 0.92 0.040 0.020</span></span>
<span><span class="co">#&gt; [3,] 0.04 0.02 0.959 0.929</span></span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span><span class="op">$</span><span class="va">TaR</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [[1]][[1]]</span></span>
<span><span class="co">#&gt;      [,1] [,2]  [,3]  [,4]</span></span>
<span><span class="co">#&gt; [1,] 0.01 0.01 0.001 0.001</span></span>
<span><span class="co">#&gt; [2,] 0.95 0.92 0.040 0.020</span></span>
<span><span class="co">#&gt; [3,] 0.04 0.02 0.959 0.929</span></span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/change_blood_weights.html">change_blood_weights</a></span><span class="op">(</span><span class="va">params</span>, <span class="va">searchWtsH</span><span class="op">)</span></span>
<span><span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_inits.html">get_inits</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_WB.html">make_WB</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">params</span>, <span class="va">y0</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span><span class="op">$</span><span class="va">vars</span><span class="op">$</span><span class="va">W</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1]   2.0 114.3 934.2</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/change_calK.html">change_calK</a></span><span class="op">(</span><span class="va">calK</span>, <span class="va">params</span><span class="op">)</span></span>
<span><span class="va">params</span><span class="op">$</span><span class="va">MYZpar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">calK</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span><span class="co">#&gt; [1,]  0.0  0.6  0.3</span></span>
<span><span class="co">#&gt; [2,]  0.4  0.0  0.7</span></span>
<span><span class="co">#&gt; [3,]  0.6  0.4  0.0</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_Omega.html">get_Omega</a></span><span class="op">(</span><span class="va">params</span>, <span class="fl">1</span><span class="op">)</span> </span>
<span><span class="co">#&gt;             [,1]        [,2]        [,3]</span></span>
<span><span class="co">#&gt; [1,]  0.12500000 -0.02500000 -0.01250000</span></span>
<span><span class="co">#&gt; [2,] -0.01666667  0.12500000 -0.02916667</span></span>
<span><span class="co">#&gt; [3,] -0.02500000 -0.01666667  0.12500000</span></span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_Upsilon.html">get_Upsilon</a></span><span class="op">(</span><span class="va">params</span>, <span class="fl">1</span><span class="op">)</span> </span>
<span><span class="co">#&gt;            [,1]       [,2]       [,3]</span></span>
<span><span class="co">#&gt; [1,] 0.23643097 0.07241259 0.04640076</span></span>
<span><span class="co">#&gt; [2,] 0.05790317 0.23926276 0.08391499</span></span>
<span><span class="co">#&gt; [3,] 0.07354531 0.05620409 0.23756369</span></span></code></pre></div>
<p>Functions like <code>set_habitat_wts_static</code> are designed to
modify parameters to guarantee that all the internal objects that rely
on those parameters get updated. If we use
<code>set_habitat_wts_static</code> the updating gets done
automatically.</p>
<p>The software was designed to handled more complex situations than the
one we’ve illustrated here. In some models, we might want to make the
habitat search weights change dynamically. For example, we might want to
simulate habitat dynamics with some ephemeral habitats that dry up and
can’t be found. That would be called a <em>non-autonomous</em> system,
and we would need to recompute the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Q</mi><annotation encoding="application/x-tex">Q</annotation></semantics></math>
and <span class="math inline">$\cal U$</span> each time step. The egg
laying object is assigned a class <code>dynamic</code> for dispatching
by R’s S3 object system. If none of the values affecting egg laying are
time dependent – we would call the resulting system <em>autonomous</em>
– then we assign the objects a class <code>static</code> so they don’t
get updated. To guarantee that we are recomputing things correctly,
whenever the software updates the values of static parameters, it
assigns the class <code>setup.</code> Whenever
<code>EggLaying.setup</code> gets called, it runs
<code>EggLaying.dynamic</code> once and then changes the class to
<code>static.</code></p>
</div>
</div>
<div class="section level3">
<h3 id="solving">Solving<a class="anchor" aria-label="anchor" href="#solving"></a>
</h3>
<p>Now we can get the initial conditions of the model.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_indices.html">make_indices</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="numerical-solution">Numerical Solution<a class="anchor" aria-label="anchor" href="#numerical-solution"></a>
</h3>
<p>Now we can pass the vector of initial conditions, <code>y</code>, our
parameter list <code>params</code>, and the function
<code><a href="../reference/xde_derivatives.html">ramp.xds::xde_derivatives</a></code> to the differential equation
solvers in <code><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">deSolve::ode</a></code> to generate a numerical trajectory.
The classes of <code>Xpar</code>, <code>MYZpar</code>, and
<code>Lpar</code> in <code>params</code> will ensure that the right
methods are invoked (dispatched) to solve your model.</p>
<p>We need to get the stored initial values, but by default these are
returned as a named list, to make it easy to examine.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_inits.html">get_inits</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">y0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "L"   "MYZ" "X"</span></span></code></pre></div>
<p>We want to pass an unnamed vector to the solver so:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y0</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_inits.html">get_inits</a></span><span class="op">(</span><span class="va">params</span>, flatten<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/dede.html" class="external-link">dede</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y0</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">735</span>, by <span class="op">=</span><span class="fl">15</span><span class="op">)</span>,</span>
<span>                    func <span class="op">=</span> <span class="va">xde_derivatives</span>, parms <span class="op">=</span> <span class="va">params</span><span class="op">)</span></span>
<span><span class="va">out1</span> <span class="op">&lt;-</span> <span class="va">out</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-output">Plot Output<a class="anchor" aria-label="anchor" href="#plot-output"></a>
</h3>
<p>With a small amount of data wrangling made easier by the
<code>data.table</code> package, we can plot the output.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">params</span><span class="op">$</span><span class="va">ix</span><span class="op">$</span><span class="va">L</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">L_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'L_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">params</span><span class="op">$</span><span class="va">nHabitats</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">params</span><span class="op">$</span><span class="va">ix</span><span class="op">$</span><span class="va">MYZ</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">M_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'M_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">params</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">params</span><span class="op">$</span><span class="va">ix</span><span class="op">$</span><span class="va">MYZ</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">P_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'P_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">params</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">params</span><span class="op">$</span><span class="va">ix</span><span class="op">$</span><span class="va">MYZ</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Y_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Y_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">params</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">params</span><span class="op">$</span><span class="va">ix</span><span class="op">$</span><span class="va">MYZ</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Z_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Z_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">params</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">params</span><span class="op">$</span><span class="va">ix</span><span class="op">$</span><span class="va">X</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">X_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'X_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">params</span><span class="op">$</span><span class="va">nStrata</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">out</span>, id.vars <span class="op">=</span> <span class="st">'time'</span><span class="op">)</span></span>
<span><span class="va">out</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Component"</span>, <span class="st">"Stratification"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/tstrsplit.html" class="external-link">tstrsplit</a></span><span class="op">(</span><span class="va">variable</span>, <span class="st">'_'</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">out</span><span class="op">[</span>, <span class="va">variable</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">out</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">Stratification</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">Component</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex_534_files/figure-html/unnamed-chunk-29-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="using-xde_setup">Using <code>xde_setup</code><a class="anchor" aria-label="anchor" href="#using-xde_setup"></a>
</h2>
<p>We create lists with all our parameters values:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MYZo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span> g <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">12</span>, sigma <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">12</span><span class="op">/</span><span class="fl">2</span>,</span>
<span> f <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, q<span class="op">=</span><span class="fl">0.9</span>, nu<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span> eggsPerBatch <span class="op">=</span> <span class="fl">30</span>, </span>
<span> eip <span class="op">=</span> <span class="fl">12</span>, </span>
<span> M <span class="op">=</span> <span class="fl">100</span>,  P <span class="op">=</span> <span class="fl">10</span>,  Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">0</span> </span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Lo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span> L <span class="op">=</span> <span class="fl">1</span>,  </span>
<span> psi <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">8</span>, phi <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">8</span>, </span>
<span> theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">20</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">40</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span> </span>
<span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Xo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span> I <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">*</span><span class="va">HPop</span><span class="op">)</span>,</span>
<span> r <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">200</span>,</span>
<span> b <span class="op">=</span> <span class="fl">0.55</span>,</span>
<span> c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">.02</span>, <span class="fl">.1</span>, <span class="fl">.02</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/xds_setup.html">xds_setup</a></span><span class="op">(</span>MYZname<span class="op">=</span><span class="st">"macdonald"</span>, Xname<span class="op">=</span><span class="st">"SIS"</span>, Lname<span class="op">=</span><span class="st">"basicL"</span>, </span>
<span>  nPatches <span class="op">=</span> <span class="fl">3</span>, HPop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">90</span>, <span class="fl">100</span>, <span class="fl">900</span><span class="op">)</span>, </span>
<span>  membership<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>  MYZopts<span class="op">=</span><span class="va">MYZo</span>, calK<span class="op">=</span><span class="va">calK</span>, Xopts<span class="op">=</span><span class="va">Xo</span>, Lopts <span class="op">=</span> <span class="va">Lo</span>,</span>
<span>  residence<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>, searchB<span class="op">=</span><span class="va">searchWtsH</span>, </span>
<span>  TimeSpent<span class="op">=</span><span class="va">TaR</span>, searchQ <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">8</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">mod534</span></span></code></pre></div>
<p>We solve and take the differences to check:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod534</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xds_solve.html">xds_solve</a></span><span class="op">(</span><span class="va">mod534</span>, Tmax<span class="op">=</span><span class="fl">735</span>, dt<span class="op">=</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">mod534</span><span class="op">$</span><span class="va">outputs</span><span class="op">$</span><span class="va">orbits</span><span class="op">$</span><span class="va">deout</span> <span class="op">-&gt;</span> <span class="va">out2</span></span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/xds_plot_M.html">xds_plot_M</a></span><span class="op">(</span><span class="va">mod534</span>, llty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex_534_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
<p>Interestingly, the differences are small:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">out2</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">out1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/approx_equal.html">approx_equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">out2</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">out1</span>,<span class="fl">1</span><span class="op">)</span>, tol <span class="op">=</span> <span class="fl">1e-5</span><span class="op">)</span></span>
<span><span class="co">#&gt; logical(0)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
