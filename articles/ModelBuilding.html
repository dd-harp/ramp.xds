<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Progressive Model Building • ramp.xds</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Progressive Model Building">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ramp.xds</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0-0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/GettingStarted.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/BasicSetup.html">Basic Setup</a></li>
    <li><a class="dropdown-item" href="../articles/modular_forms.html">Modular Forms</a></li>
    <li><a class="dropdown-item" href="../articles/Exposure.html">Exposure</a></li>
    <li><a class="dropdown-item" href="../articles/Contributing.html">Contributing</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-adult-mosquitoes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Adult Mosquitoes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-adult-mosquitoes">
<li><a class="dropdown-item" href="../articles/adult_RM.html">Macdonald's Model</a></li>
    <li><a class="dropdown-item" href="../articles/RM-dts-Mosquito.html">Ross-Macdonald - discrete time</a></li>
    <li><a class="dropdown-item" href="../articles/adult_GeRM.html">Generalized Ross-Macdonald model</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-immature-mosquitoes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Immature Mosquitoes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-immature-mosquitoes">
<li><a class="dropdown-item" href="../articles/aqua_trace.html">Emergence (the trivial module)</a></li>
    <li><a class="dropdown-item" href="../articles/aqua_basic.html">basicL</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-human-host" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Human / Host</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-human-host">
<li><a class="dropdown-item" href="../articles/human_sis.html">SIS model</a></li>
    <li><a class="dropdown-item" href="../articles/human_hmoi.html">MoI hybrid model</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dd-harp/ramp.xds/"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Progressive Model Building</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/ramp.xds/blob/main/vignettes/ModelBuilding.Rmd" class="external-link"><code>vignettes/ModelBuilding.Rmd</code></a></small>
      <div class="d-none name"><code>ModelBuilding.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dd-harp.github.io/ramp.xds/">ramp.xds</a></span><span class="op">)</span></span></code></pre></div>
<p><strong><code>ramp.xds</code></strong> is based on a mathematical
framework for model building that is modular, flexible and extensible.
Using the built-in functions, it’s comparatively easy to build highly
<em>realistic</em> models by starting simple and adding features one at
a time. We call this <em>progressive model building.</em></p>
<p>In the vignette <a href="GettingStarted.html">Getting Started</a>, we
introduced the function <code>xds_setup().</code> From a software design
perspective, a setup interface can’t possibly anticipate the needs of
every end user without constraining possibilities. The point of
<code><a href="../reference/xds_setup.html">xds_setup()</a></code> is to help build models up to a certain level
of complexity. Instead, we have adopted a system for <em>progressive
model building</em> based on a mathematical framework and the idea of
<em>scaling complexity.</em></p>
<p>Progressive model building is a practical method for building complex
models in two phases:</p>
<ul>
<li><p><strong>Basic Setup</strong> is handled by the function
<code>xds_setup().</code> It’s designed to help a user get started with
a properly formulated interface that can handle spatial dynamics,
structured aquatic habitats, and a stratified human population.</p></li>
<li><p><strong>Advanced Setup</strong> handles advanced features,
including exogenous forcing, vector control, and other modes of malaria
control, human demography and aging, and host population
stratification.</p></li>
</ul>
<p>In the following, we introduce <strong>Basic Setup</strong></p>
<div class="section level2">
<h2 id="modularity-and-etensibility">Modularity and Etensibility<a class="anchor" aria-label="anchor" href="#modularity-and-etensibility"></a>
</h2>
<p>A mathematical framework supported the design of
<strong><code>ramp.xds.</code></strong> That framework handles a subset
of the universe of all possible models. That subset can be understood as
nested, hierarchical sets of models expanding out from a set of simple
base models. Notably, the math works bass ackwards. We could be more
rigorous in defining what we mean by all that, but this vignette is not
the place for it. We use the concept to motivate progressive model
building.</p>
<p>Basic setup was designed around simple models with structural
flexibility. Each model returned by basic setup could serve as a
platform for developing models of unbounded realism and complexity. To
make this work, the software built in ports and junctions that could
handle a large set of advanced features, but most of these features
would be turned off for basic setup.</p>
<div class="section level3">
<h3 id="modularity">Modularity<a class="anchor" aria-label="anchor" href="#modularity"></a>
</h3>
<p>The framework is designed around five dynamical components organized
into three chunks:</p>
<ol style="list-style-type: decimal">
<li>
<p>The vertebrate host population, denoted <span class="math inline">\(\mathcal{XH}\)</span>:</p>
<ul>
<li><p>human (or host) demography (<span class="math inline">\(\mathcal
H\)</span>) including births, deaths, aging and migration;</p></li>
<li><p>malaria epidemiology (<span class="math inline">\(\mathcal
X\)</span>), in the narrow sense; or more generally, the dynamics of
infection and immunity in the host population;</p></li>
</ul>
</li>
<li>
<p>The adult mosquito population, denoted <span class="math inline">\(\mathcal {MYZ}\)</span>:</p>
<ul>
<li><p>mosquito ecology (<span class="math inline">\(\mathcal
M\)</span>)</p></li>
<li><p>mosquito infection dynamics (<span class="math inline">\(\mathcal
Y\)</span>)</p></li>
</ul>
</li>
<li><p>Aquatic mosquito ecology, denoted <span class="math inline">\(\mathcal L\)</span></p></li>
</ol>
<p>These three chunks are connected by two interfaces. The first two
chunks are connected through the rigid interface describing blood
feeding and transmission, denoted <span class="math inline">\(\mathcal
B\)</span>. The last two chunks are connected through egg laying and
emergence, <span class="math inline">\(\mathcal {N, U}\)</span>.</p>
<hr>
<div class="float">
<img src="notation1.png" alt="Figure 2 Modular dynamic components that form the core of ramp.xds"><div class="figcaption">
<strong>Figure 2</strong> Modular dynamic
components that form the core of
<strong><code>ramp.xds</code></strong>
</div>
</div>
<hr>
<p>In general, <em>module</em> is the term we use to describe an element
in the model library. Since the parameter values can be changed, each
<em>module</em> defines a <em>model family</em> in the form of a system
of differential or difference equations. Each family is defined by a set
of states and state transitions (<em>i.e.</em> by the topology of the
graph) for a single population (<code>nStrata=1</code>).</p>
<p>For example, the <code>SIS</code> module for the <span class="math inline">\(\mathcal X\)</span> component is the <em>SIS</em>
compartmental model family for human infections. It’s called a model
family because each unique set of parameters would define a different
<em>model.</em></p>
<p>In its simplest form, each model family represents the state of a
single population, but any model can replicate those states and
sub-divide a single population into sub-populations with different
parameters. These are population strata for <span class="math inline">\(\mathcal X\)</span>; adult mosquitoes in patches
for <span class="math inline">\(\mathcal {MYZ}\)</span>; immature
mosquitoes in aquatic habitats for <span class="math inline">\(\mathcal
L\)</span>. In <strong><code>ramp.xds</code></strong> it is
comparatively simple to configure a model with multiple strata, patches,
and habitats.</p>
</div>
</div>
<div class="section level2">
<h2 id="basic-setup">Basic Setup<a class="anchor" aria-label="anchor" href="#basic-setup"></a>
</h2>
<p><em>For our purposes, <strong>Basic Setup</strong> encompasses the
configurable options in <code>xds_setup().</code></em> Each model
returned by <code>xds_setup</code> is characterized by:</p>
<ul>
<li><p>A <em>model family</em> for each dynamical component, including
model parameters. The model object also stores initial values.</p></li>
<li><p>The <em>model structure,</em> including the number of patches,
the number of habitats and their membership in the patches, and the
number of human population strata and their residency within the
strata.</p></li>
<li><p>Functions that define exogenous variables and functional
responses that drive exogenous forcing by weather and malaria
control.</p></li>
</ul>
<p>The software supports a modular framework for model building that is
highly flexible and extensible. It’s capable of building very realistic
models, but progressive setup embraces a model-building philosophy of
starting simple and adding realism or complexity one step at a time.</p>
<p>The demo in <a href="GettingStarted.html">Getting Started</a> sets up
one version of the Ross-Macdonald model. It illustrates how the software
has streamlined the process of building fairly simple models. The
following sections describe how to make
<strong><code>ramp.xds</code></strong> build models that are much more
complicated and realistic.</p>
<p>As described in <a href="GettingStarted.html">Getting Started</a>,
the <code><a href="../reference/xds_setup.html">xds_setup()</a></code> function
<strong><code>ramp.xds</code></strong> has assigned default options for
everything. Each model must configure three dynamical components: human
epidemiology; adult mosquito ecology and infection dynamics; and aquatic
mosquito ecology. Each one of these three dynamical component is
configured by specifying a model name (as a string) and options, passed
as a named list, to override the defaults for the model:</p>
<ul>
<li><p><code>Xname</code> dispatches a model family for parasitic
infections and immunity in the human population, called <span class="math inline">\(\mathcal X.\)</span> The setup default model is
<code>Xname="SIS"</code> and default parameters for the <code>SIS</code>
model are defined in <code>create_Xpar_SIS.</code> To replace the
default values at setup, a named list can be passed as
<code>Xopts = list(...)</code> and the named values in
<code>Xopts</code> will be he values of named parameters and the initial
values of named variables instead of the defaults. (The human
demographic model, <span class="math inline">\(\mathcal H\)</span> is
set up as an advanced option.)</p></li>
<li><p><code>MYZname</code> dispatches a model family for adult mosquito
ecology and parasite infection dynamics, <span class="math inline">\(\mathcal {MYZ}.\)</span> The setup default model
is <code>MYZname="macdonald"</code> and default parameters for the
<code>macdonald</code> model are defined in
<code>make_MYZpar_macdonald.</code> To replace the default values at
setup, a named list can be passed as <code>MYZopts = list(...)</code>
and the named values in <code>MYZopts</code> will set the values of
named parameters and the initial values of named variables instead of
the defaults.</p></li>
<li><p><code>Lname</code> specifies a model family for aquatic mosquito
ecology, <span class="math inline">\(\mathcal L.\)</span> The setup
default model is the trivial model <code>Lname = "trivial"</code>. It
has no variables, but it passes the outputs – emerging adults – as a
parameter. To replace the default values at setup, a named list can be
passed as <code>Lopts = list(...)</code> and the values in
<code>Lopts</code> will set the values of named parameters and the
initial values of named variables instead of the defaults.</p></li>
</ul>
<div class="section level3">
<h3 id="defaults">Defaults<a class="anchor" aria-label="anchor" href="#defaults"></a>
</h3>
<p>Thu function call:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1</span> <span class="op">=</span> <span class="fu"><a href="../reference/xds_setup.html">xds_setup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>returns the same values as the function call:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model2</span> <span class="op">=</span> <span class="fu"><a href="../reference/xds_setup.html">xds_setup</a></span><span class="op">(</span>Xname <span class="op">=</span> <span class="st">"SIS"</span>, </span>
<span>                   MYZname <span class="op">=</span> <span class="st">"macdonald"</span>, </span>
<span>                   Lname <span class="op">=</span> <span class="st">"trivial"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="structural-parameters">Structural Parameters<a class="anchor" aria-label="anchor" href="#structural-parameters"></a>
</h3>
<p>Structural parameters describe things like the number of patches, the
number of population strata, the number of aquatic habitats, the number
of host species, and the number of vector species.
<code>xds_setup</code> sets up models with one host species and one
vector species, users can configure a malaria landscape with <em>spatial
dynamics,</em> structured <em>aquatic habitats,</em> and <em>multiple
human / host</em> population strata. Basic setup was developed to ensure
that all interfaces are set up properly when there are multiple patches,
multiple habitats, multiple population strata, and malaria importation.
The software and documentation follow the mathematical framework
formulas and (with small changes) the notation in <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1010684" class="external-link">Wu
SL, <em>et. al.</em> 2023</a>. The following structural parameters can
be set through <code>xds_setup:</code></p>
<ul>
<li><p><strong><code>nPatches</code></strong> or <span class="math inline">\(n_p\)</span> is the number of patches in the
model.</p></li>
<li><p><strong><code>membership</code></strong> is set up by passing a
vector with the identity of patch where each habitat can be found, and
it sets up the habitat matrix, <span class="math inline">\(\mathcal
N\)</span>. Setup sets the value of a variable describing the number of
habitats, <span class="math inline">\(n_q\)</span> =
<strong><code>nHabitats &lt;- length(membership)</code>.</strong> One
configurable option is <strong><code>searchQ</code></strong> with the
habitat search weights.</p></li>
<li><p><strong><code>HPop</code></strong> is a vector with human
population density, and <strong><code>residence</code></strong> is a
vector describing the location of the patch where each stratum resides.
Setup checks that <code>length(HPop) == length(residence)</code> and
sets the number of strata, <span class="math inline">\(n_h\)</span> or
<strong><code>nStrata &lt;- length(residence)</code>.</strong> It is
also possible to configure heterogeneous biting at the command line by
passing <strong><code>searchH</code></strong></p></li>
<li>
<p>If <code>nPatches &gt;1</code> then other setup-configurable
options are to pass:</p>
<ul>
<li><p>a matrix <code>calK</code> describing mosquito dispersal among
the patches.</p></li>
<li><p>a matrix <code>TimeSpent</code> can be passed to configure human
time spent</p></li>
</ul>
</li>
</ul>
<p>To learn more, we suggest taking a look at the <a href="https://dd-harp.github.io/ramp.xds/articles/ex_534.html">5-3-4
Vignette</a>, a model with 5 aquatic habitats, 3 patches, and 4 human
population strata.</p>
</div>
<div class="section level3">
<h3 id="spatial-mosquito-ecology">Spatial Mosquito Ecology<a class="anchor" aria-label="anchor" href="#spatial-mosquito-ecology"></a>
</h3>
<p>In <strong><code>ramp.xds</code>,</strong> mosquito spatial ecology
is implemented in a patch-based simulation model: a spatial domain is
subdivided into patches; and each patch contains an arbitrary number of
habitats.</p>
</div>
<div class="section level3">
<h3 id="spatial-transmission-dynamics">Spatial Transmission Dynamics<a class="anchor" aria-label="anchor" href="#spatial-transmission-dynamics"></a>
</h3>
<p>In <strong><code>ramp.xds</code>,</strong> malaria spatial dynamics
are implemented through a model of blood feeding in a patch-based
simulation model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xds_setup.html">xds_setup</a></span><span class="op">(</span>nPatches<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="human-host-population-strata">Human / Host Population Strata<a class="anchor" aria-label="anchor" href="#human-host-population-strata"></a>
</h3>
</div>
</div>
<div class="section level2">
<h2 id="advanced-setup">Advanced Setup<a class="anchor" aria-label="anchor" href="#advanced-setup"></a>
</h2>
<p><em><strong>NOTE:</strong> As demos for these advanced options get
developed, we will add the links here.</em></p>
<p><strong>Advanced Setup Options:</strong> During basic setup, two
advanced options can be configured, but most of the advanced options
must be added after basic setup.</p>
<div class="section level3">
<h3 id="spatial-dynamics">Spatial Dynamics<a class="anchor" aria-label="anchor" href="#spatial-dynamics"></a>
</h3>
<ul>
<li><p><strong>Spatial Heterogeneity</strong> –</p></li>
<li><p><strong>Human Mobility</strong> –</p></li>
<li>
<p><strong>Malaria Importation</strong> includes <em>travel</em> and
<em>visitors</em></p>
<ul>
<li><p><em>Travel Malaria</em> –In basic setup, travel malaria is set up
to model exposure while traveling, but time spent traveling and the
travel FoI are set to zero.</p></li>
<li><p><em>Visiting</em> – In basic setup, visiting is set up but the
availability of visitors is set to zero.</p></li>
</ul>
</li>
<li><p><strong>Exposure</strong> – Since catch counts data for
mosquitoes are usually well-described by the negative binomial
distribution family, <strong><code>ramp.xds</code></strong> has
implemented a step between the computation of the EIR and the FoI to
model <a href="https://dd-harp.github.io/ramp.xds/articles/heterogeneous_transmission.html#environmental-heterogeneity-in-exposure"><em>environmental
heterogeneity</em></a> based on a probability distribution function
describing the number of infective bites per person. By default,
<code>xds_setup</code> configures a Poisson model, but this can be
changed.</p></li>
<li>
<p><strong>Human Demography</strong> – In basic setup, the human
demographic model is the <em>trivial</em> model, but it can be
configured to include</p>
<ul>
<li><p>Vital dynamics: births, deaths</p></li>
<li><p>Migration</p></li>
<li><p>Cohort dynamics and aging</p></li>
<li><p>Pregnancy</p></li>
</ul>
</li>
<li><p><strong>Forcing</strong> – set up exogenous forcing, including
<em>exogenous variables</em> (<em>e.g.</em> weather and hydrology) and
the <em>functional responses</em> to compute mosquito bionomic
parameters</p></li>
<li><p><strong>Vector Control</strong> – set up vector control,
including</p></li>
<li><p><strong>Health Systems</strong> – a variety of functions to
handle surveillance and malaria control through health systems,
including care seeking, mass vaccination, IPTp</p></li>
<li><p><strong>Multiple Vector Species</strong> – Each vector species
has spatial structure, but it is also possible to configure other vector
species (or type).</p></li>
<li><p><strong>Multiple Host Species</strong> – Each host species can be
stratified, but it is also possible to configure other host species (or
types) to make setup and configuration easier.</p></li>
</ul>
<hr>
<div class="float">
<img src="ModularGeneralized.png" alt="Figure 3 – The modular structure and extensibility of ramp.xds."><div class="figcaption">
<strong>Figure 3</strong> – The modular
structure and extensibility of
<strong><code>ramp.xds</code></strong>.</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David L. Smith, Sean L. Wu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
