<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Understanding ramp.xds • ramp.xds</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Understanding ramp.xds">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ramp.xds</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99-3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/GettingStarted.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/BasicSetup.html">Basic Setup</a></li>
    <li><a class="dropdown-item" href="../articles/modular_forms.html">Modular Forms</a></li>
    <li><a class="dropdown-item" href="../articles/Exposure.html">Exposure</a></li>
    <li><a class="dropdown-item" href="../articles/Contributing.html">Contributing</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-adult-mosquitoes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Adult Mosquitoes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-adult-mosquitoes">
<li><a class="dropdown-item" href="../articles/adult_RM.html">Macdonald's Model</a></li>
    <li><a class="dropdown-item" href="../articles/RM-dts-Mosquito.html">Ross-Macdonald - discrete time</a></li>
    <li><a class="dropdown-item" href="../articles/adult_GeRM.html">Generalized Ross-Macdonald model</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-immature-mosquitoes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Immature Mosquitoes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-immature-mosquitoes">
<li><a class="dropdown-item" href="../articles/aqua_trace.html">Emergence (the trivial module)</a></li>
    <li><a class="dropdown-item" href="../articles/aqua_basic.html">basicL</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-human-host" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Human / Host</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-human-host">
<li><a class="dropdown-item" href="../articles/human_sis.html">SIS model</a></li>
    <li><a class="dropdown-item" href="../articles/human_hmoi.html">MoI hybrid model</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dd-harp/ramp.xds/"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Understanding ramp.xds</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/ramp.xds/blob/v0.99-3-beta/vignettes/Understanding_ramp.xds.Rmd" class="external-link"><code>vignettes/Understanding_ramp.xds.Rmd</code></a></small>
      <div class="d-none name"><code>Understanding_ramp.xds.Rmd</code></div>
    </div>

    
    
<p>This vignette gives a high-level overview of <code>ramp.xds</code>
internals.</p>
<p>The software design implements the mathematical framework described
in <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1010684" target="_blank" class="external-link">Spatial Dynamics of Malaria Transmission</a>.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>A goal for <code>ramp.xds</code> was to lower the costs, in terms of
human time and capital, of developing models that are realistic enough
to support decisions affecting malaria policies. An operating assumption
for developing this framework and software has been that robust decision
support for malaria policies would put demands on model-building that
often differ from what is expected from a scientific publication. For
models to work in a policy setting, they must be <em>realistic</em>
enough to be relevant to the policy discussions.</p>
<p>This need for realism in models drove development of malaria models
as funding flowed into malaria in the development goals era. The need
for realism and practical ways of dealing with the associated
<em>computational complexity</em> drove the development of several
comprehensive <em>individual-based models</em> (IBMs), such as
OpenMalaria, eMod, and MalariaTools. While IBMs have some advantages,
they also have some disadvantages, including the high costs of using
them. We thus sought to develop software that could handle enough
computational complexity to address the needs of malaria programs. One
advantage of using systems of differential equations is that they are
much easier to analyze.</p>
<p>Cost savings would come in time spent formulating, coding, verifying,
debugging, &amp; applying these models.</p>
</div>
<div class="section level2">
<h2 id="scaling-complexity">Scaling Complexity<a class="anchor" aria-label="anchor" href="#scaling-complexity"></a>
</h2>
<p>Among the most important questions for modeling is what level of
complexity is appropriate for various different kinds of analysis. Given
our interest in adaptive malaria control, we wanted to be able to
conduct studies that could address questions about the value of
gathering new data about features of local malaria transmission in a
place. In developing this framework we thus wanted the capability of
building simple models models and then adding <em>realism</em> through
elaboration.</p>
<p>Good models built to purpose would be – as Einstein suggested –
<em>as simple as possible, but no simpler.</em> While most people would
agree with Einstein in principle, he provided no usable advice about how
to do this. How would you know a model had the right level of
complexity? One way is to develop at least one model that is clearly too
complex and then to provide some rigorous model selection on a suite of
models of varying levels of complexity. How could we ever know that we
had build a model that was at the right level of complexity if we had
never developed a model that had demonstrably gone too far?</p>
<p>We thus wanted a framework that could build simple models, models
with potentially unbounded realism and complexity, and a large set of
models in between. In other words, we wanted the capability of
<em>scaling complexity.</em> The kinds of realism we imagined
included:</p>
<ul>
<li><p>realistic human demography, including age structure, births &amp;
deaths, and migration;</p></li>
<li><p>human population heterogeneity, including differences in care
seeking or any heterogeneous trait that was relevant for malaria
epidemiology or transmission;</p></li>
<li><p>multiple host and vector species or types;</p></li>
<li><p>spatial heterogeneity and spatial dynamics, including human
mobility and mosquito dispersal, indoor and outdoor spaces, malaria
importation, and mosquito migration.</p></li>
<li><p>realistic mosquito ecology with exogenous forcing by weather and
other factors;</p></li>
<li><p>integrated vector control and interventions delivered through
health systems;</p></li>
</ul>
<p>At the same time, we wanted to have the flexibility to isolate and
analyze various components of the model. Since the framework is modular,
it should be possible to pass the inputs to one (or more) of the
dynamical components from a <em>trivial</em> function, rather than from
a fully coupled model. These trivial models also provide one way of
rigorously pressure testing the software and verifying the code.</p>
<p>We think of models as having a defined <em>skill set,</em> or output
variables that naturally represent a subset of quantities that would be
predicted by a model. The framework should make it easy to build models
that have the right subset of features, including a set of dynamical
components with skill sets that were up to any task.</p>
</div>
<div class="section level2">
<h2 id="nimble-model-building-and-modularity">Nimble Model Building and Modularity<a class="anchor" aria-label="anchor" href="#nimble-model-building-and-modularity"></a>
</h2>
<p>To support decisions affecting malaria policy, model building must be
<em>nimble.</em> As malaria programs integrate sophisticated analytics
into their decision-making, the conversation in a room can shift. Over
time, programmatic priorities and needs can change. To keep up, the
model builders <em>ought</em> to have the capability of building new
models that could address the new concerns. While this might not be
possible to do in real time, it should be possible to have a new model
developed with preliminary results within a week or so.</p>
<p>With these goals in mind, we developed a mathematical framework that
could make computation for dynamical systems <strong>modular.</strong>
The mathematical basis for modularity was described in <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1010684" target="_blank" class="external-link">Spatial Dynamics of Malaria Transmission</a>. (Also, see
the related vignettes on <a href="modular-forms.html" target="_blank">modular forms</a> and <a href="modularity.html">modularity</a>.)</p>
<p>We identified five kinds of processes grouped into three inseparable
chunks, the core dynamical components. The chunks represented five
distinct processes:</p>
<ul>
<li>
<p><span class="math inline">\(\cal XH\)</span> - Human demography
and parasite infection dynamics, including immunity and disease,
diagnostics and treatment,</p>
<ul>
<li><p><span class="math inline">\(\cal X\)</span> - The dynamical
process describing the dynamics of human infection and immunity</p></li>
<li><p><span class="math inline">\(\cal H\)</span> - A dynamical model
describing human demography</p></li>
</ul>
</li>
<li>
<p><span class="math inline">\(\cal MYZ\)</span> - Adult mosquito
ecology and behavior, and parasite infection dynamics</p>
<ul>
<li><p><span class="math inline">\(\cal M\)</span> - The model for adult
mosquito ecology</p></li>
<li><p><span class="math inline">\(\cal YZ\)</span> - The model for
adult mosquito infection dynmics, consistent with <span class="math inline">\(\cal M\)</span></p></li>
</ul>
</li>
<li><p><span class="math inline">\(\cal L\)</span> - Aquatic mosquito
ecology</p></li>
</ul>
<p>The three core dynamical components were connected by two rigid
interfaces, discussed at greater length below:</p>
<ul>
<li><p><span class="math inline">\(\cal B\)</span> - Blood
Feeding</p></li>
<li><p><span class="math inline">\(\cal U\)</span> - Egg laying and
emergence</p></li>
</ul>
<p>Exogenous forcing was implemented largely through a flexible set of
processes that set the value of <em>exogenous variables</em> and
functions to modify model parameters affecting <em>endogenous
dynamics.</em></p>
</div>
<div class="section level2">
<h2 id="structural-elements">Structural Elements<a class="anchor" aria-label="anchor" href="#structural-elements"></a>
</h2>
<p>Each model has several parameters that describe the structure of a
model:</p>
<ul>
<li><p><strong>Malaria Epidemiology</strong> or the model for infection
dynamics and immunity in humans (<span class="math inline">\(\cal
X\)</span>) is specified by passing <code>Xname</code> – a string,
corresponding to a model from the <code>ramp.xds</code> library, that
specifies the model family for human infection dynamics that gets
dispatched by the S3 function implementing <span class="math inline">\(\cal X\)</span> tasks.</p></li>
<li>
<p>How many <strong>host species</strong> are there? The number of
distinct <em>vertebrate host</em> species (or types) in a model is
<code>pars$nHosts</code></p>
<ul>
<li><p>The model for the human population for the <span class="math inline">\(i^{th}\)</span> species is defined by
<code>pars$Xpar[[i]]</code></p></li>
<li><p>The demographic model for the <span class="math inline">\(i^{th}\)</span> species is defined by
<code>pars$Hpar[[i]]</code></p></li>
<li><p>A vector passed at setup, <code>HPop,</code> defines the
population density for the population strata of each vertebrate host
species.</p></li>
<li><p>The length of <code>HPop</code> is used to set the value of
<code>nStrata</code></p></li>
</ul>
</li>
<li>
<p><strong>Mosquito Ecology</strong> has two parts:</p>
<ul>
<li><p>The model family for <strong>adult mosquito</strong> infection
dynamics and ecology is specified by <code>MYZname</code> – a string,
corresponding to a model from the <code>ramp.xds</code> library, that
specifies the model family for adult mosquitoes</p></li>
<li><p>The model family <strong>aquatic mosquito</strong> population
dynamics is passed as <code>Lname</code> – a string, corresponding to a
model from the <code>ramp.xds</code> library, that specifies the model
family for aquatic mosquito population dynamics that should be
used</p></li>
</ul>
</li>
<li>
<p>How many <strong>vector species</strong> are there? The number of
distinct <em>mosquito vector</em> species (or type) in a model is
<code>pars$nVectors</code> Each vector species is defined by a two sets
of parameters:</p>
<ul>
<li><p>The model for the adult population for the <span class="math inline">\(s^{th}\)</span> species is defined by
<code>pars$MYZpar[[s]]</code></p></li>
<li><p>The model for the aquatic population for the <span class="math inline">\(s^{th}\)</span> species is defined by
<code>pars$Lpar[[s]]</code></p></li>
</ul>
</li>
<li><p><strong>Spatial dynamics</strong> are implemented through
patch-based metapopulation models, where <code>pars$nPatches</code> is
the number of distinct <em>patches</em> in a model.</p></li>
<li>
<p>Immature Mosquitoes are found in <strong>Aquatic
Habitats.</strong> A parameter <code>pars$nHabitats</code> is the number
of distinct aquatic habitats in a model. Additional information is
needed to configure the model for <em>egg laying</em> (see below):</p>
<ul>
<li><p>a <code>membership</code> vector is required: the <span class="math inline">\(i^{th}\)</span> element of the membership matrix,
<span class="math inline">\(\cal N,\)</span> identifies the patch to
which it belongs.</p></li>
<li><p>a <code>searchQ</code> vector is required: the <span class="math inline">\(i^{th}\)</span> element gives the habitat
<em>search weight</em> to compute the egg laying matrix, <span class="math inline">\(\cal U\)</span></p></li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="dynamics">Dynamics<a class="anchor" aria-label="anchor" href="#dynamics"></a>
</h2>
<ul>
<li>
<p>Models for human ecology and parasite / pathogen infection
dynamics would appear in one dynamical component. The part that computes
the dynamics of infection and immunity was called <span class="math inline">\(\cal X\)</span>, and the part that describes human
demography was called <span class="math inline">\(\cal H.\)</span> These
two components can’t be separated in any easy way, so we call this chunk
<span class="math inline">\(\cal XH\)</span>.</p>
<ul>
<li><p>The derivatives for a model of class <span class="math inline">\(\cal X\)</span> for the <span class="math inline">\(i^{th}\)</span> species is computed by a
<code>S3</code> function <code>dXdt(t, y, pars, i)</code></p></li>
<li><p>The updating function for a model of class <span class="math inline">\(\cal X\)</span> for the <span class="math inline">\(i^{th}\)</span> species is computed by a
<code>S3</code> function <code>DT_Xt(t, y, pars, i)</code></p></li>
<li><p>The parameters for the model are in an object called
<code>Xpar</code> and <code>dXdt</code> dispatches on
<code>class(Xpar)</code></p></li>
<li><p>Since there could be multiple host species, <code>Xpar</code> for
the <span class="math inline">\(i^{th}\)</span> species is
<code>pars$Xpar[[i]].</code></p></li>
<li><p>The demographic model, <span class="math inline">\(\cal
H\)</span>, configured as a birth process, <span class="math inline">\(B(t)\)</span>, and a linear tranformation among
strata (including mortality), <code>dHdt(y, pars)</code> called from
<code>dXdt</code></p></li>
</ul>
</li>
<li>
<p>Models for adult mosquito ecology and parasite / pathogen
infection dynamics would appear in a second dynamical component. The
part that computes the dynamics of infection was called <span class="math inline">\(\cal YZ\)</span>, and the part that computes
mosquito population dynamics was called <span class="math inline">\(\cal
M\)</span>. These two components can’t be separated in any easy way, so
we call this chunk <span class="math inline">\(\cal MYZ\)</span>.</p>
<ul>
<li><p>The derivatives for a model of this type are computed by a
<code>S3</code> function <code>dMYZdt(t, y, pars, s)</code> or
<code>dMdt(t, y, pars, s)</code> for the <span class="math inline">\(s^{th}\)</span> vector species</p></li>
<li><p>The updating function for a model of class <span class="math inline">\(\cal MYZ\)</span> for the <span class="math inline">\(i^{th}\)</span> species is computed by a
<code>S3</code> function <code>DT_MYZt(t, y, pars, s)</code></p></li>
<li><p>The parameters for the model are in an object called
<code>MYZpar</code> and <code>dMYZdt</code> and <code>DT_MYZt</code>
dispatch on <code>class(MYZpar)</code></p></li>
<li><p>Since there could be multiple host species, <code>MYZpar</code>
for the <span class="math inline">\(i^{th}\)</span> species is
<code>pars$MYZpar[[i]].</code></p></li>
</ul>
</li>
<li>
<p>Models for aquatic mosquito ecology were called <span class="math inline">\(\cal L\)</span>.</p>
<ul>
<li><p>The derivatives for a model of this type are computed by a
<code>S3</code> function <code>dLdt(t, y, pars, s)</code> or
<code>DT_Lt(t, y, pars, s)</code></p></li>
<li><p>The updating function for a model of class <span class="math inline">\(\cal MYZ\)</span> for the <span class="math inline">\(i^{th}\)</span> species is computed by a
<code>S3</code> function <code>DT_MYZt(t, y, pars, s)</code></p></li>
<li><p>The parameters for the model are in an object called
<code>Lpar</code> and <code>dLdt</code> and <code>DT_Lt</code> dispatch
on <code>class(Lpar)</code></p></li>
<li><p>Since there could be multiple host species, <code>Lpar</code> for
the <span class="math inline">\(i^{th}\)</span> species is
<code>pars$Lpar[[i]].</code></p></li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="interfaces">Interfaces<a class="anchor" aria-label="anchor" href="#interfaces"></a>
</h2>
<p>In developing a modular framework, we recognized the need to develop
a rigorous yet flexible <em>interface</em> that would allow different
dynamical components to interact.</p>
<p>To connect these two dynamical components, we developed two
well-defined interfaces: <strong>blood feeding</strong> and <strong>egg
laying.</strong></p>
<div class="section level3">
<h3 id="blood-feeding">Blood Feeding<a class="anchor" aria-label="anchor" href="#blood-feeding"></a>
</h3>
<p>A <em>model</em> for <strong>blood feeding</strong> and parasite /
pathogen <strong>transmission</strong> by mosquitoes. This model
<em>should</em> constrain mosquito blood feeding rates and the human
fraction in sensible ways. It is possible to set the values of mosquito
bionomic parameters to static values that are not constrained. In <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1010684" target="_blank" class="external-link">Spatial Dynamics of Malaria Transmission</a>, we
introduce a fully defined blood feeding module that constrains the blood
feeding rate and the human fraction using the concept of <em>resource
availability.</em></p>
<p>If <code>nPatches</code><span class="math inline">\(&gt;1\)</span> or
if <code>nStrata</code><span class="math inline">\(&gt;1\)</span>, then
it is necessary to supply some additional information to configure the
mixing matrix, <span class="math inline">\(\beta\)</span>, which is
attached as <code>pars$beta[[i]][[s]]</code> for the <span class="math inline">\(i^{th}\)</span> host and <span class="math inline">\(s^{th}\)</span> vector species.</p>
<ul>
<li><p>A <em>time spent</em> matrix must be configured for each host
species</p></li>
<li><p>A vector of <em>blood feeding search weights</em> must be
provided for each stratum, and for each species. The <span class="math inline">\(i^{th}\)</span> element of the <span class="math inline">\(s^{th}\)</span> vector is used to compute its
<em>availability</em> to hosts for blood feeding.</p></li>
<li><p>A <em>circadian weighting function</em> is required for each
vector species, which is used to transform the <span class="math inline">\(i^{th}\)</span> time spent matrix into a set of
<code>nVectors</code> matrices describing <em>time at
risk.</em></p></li>
<li><p>A <em>demographic</em> matrix must be configured for each
mosquito species that describes mosquito survival and dispersal in the
patches.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="egg-laying">Egg Laying<a class="anchor" aria-label="anchor" href="#egg-laying"></a>
</h3>
<p>A description of the locations of aquatic habitats and a
<em>model</em> for <strong>egg laying</strong> and
<strong>emergence.</strong></p>
<ul>
<li><p>A <em>membership</em> vector must be provided: the <span class="math inline">\(i^{th}\)</span> element is the index of the patch
where the habitat is found</p></li>
<li><p>A <em>search</em> vector must be provided: the <span class="math inline">\(i^{th}\)</span> element is the index of the patch
where the habitat is found</p></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
