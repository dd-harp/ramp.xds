<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The SIS Module • ramp.xds</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The SIS Module">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ramp.xds</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.6-0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/GettingStarted.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/BasicSetup.html">Basic Setup</a></li>
    <li><a class="dropdown-item" href="../articles/Working.html">The xds Model Object</a></li>
    <li><a class="dropdown-item" href="../articles/ex_534.html">The 5-3-4 Model</a></li>
    <li><a class="dropdown-item" href="../articles/Delays.html">Delay Equations</a></li>
    <li><a class="dropdown-item" href="../articles/Forcing.html">Ports &amp; Junctions</a></li>
    <li><a class="dropdown-item" href="../articles/DTS.html">Discrete Time Systems</a></li>
    <li><a class="dropdown-item" href="../articles/TraceFunctions.html">Functions</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-interfaces" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Interfaces</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-interfaces">
<li><a class="dropdown-item" href="../articles/modular_forms.html">Modular Forms</a></li>
    <li><a class="dropdown-item" href="../articles/EggLaying.html">Habitats &amp; Mosquito Ecology</a></li>
    <li><a class="dropdown-item" href="../articles/BloodFeeding.html">Blood Feeding &amp; Transmission</a></li>
    <li><a class="dropdown-item" href="../articles/Exposure.html">Exposure</a></li>
    <li><a class="dropdown-item" href="../articles/MosquitoBionomics.html">Bionomics</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-human-host" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Human / Host</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-human-host">
<li><a class="dropdown-item" href="../articles/XH-interface.html">XH Component</a></li>
    <li><a class="dropdown-item" href="../articles/human_sis.html">The SIS Module</a></li>
    <li><a class="dropdown-item" href="../articles/human_hmoi.html">MoI hybrid model</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-adult-mosquitoes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Adult Mosquitoes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-adult-mosquitoes">
<li><a class="dropdown-item" href="../articles/MY-interface.html">The MY Component</a></li>
    <li><a class="dropdown-item" href="../articles/adult_RM.html">Macdonald's Model</a></li>
    <li><a class="dropdown-item" href="../articles/RM-dts-Mosquito.html">Ross-Macdonald - discrete time</a></li>
    <li><a class="dropdown-item" href="../articles/adult_GeRM.html">Generalized Ross-Macdonald model</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-immature-mosquitoes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Immature Mosquitoes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-immature-mosquitoes">
<li><a class="dropdown-item" href="../articles/L-interface.html">The L Component</a></li>
    <li><a class="dropdown-item" href="../articles/aqua_trace.html">Emergence (the trivial module)</a></li>
    <li><a class="dropdown-item" href="../articles/aqua_basic.html">basicL</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dd-harp/ramp.xds/"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>The SIS Module</h1>
            <h3 data-toc-skip class="subtitle">Generalized, Modular SIS
Infection Dynamics</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/ramp.xds/blob/main/vignettes/human_sis.Rmd" class="external-link"><code>vignettes/human_sis.Rmd</code></a></small>
      <div class="d-none name"><code>human_sis.Rmd</code></div>
    </div>

    
    
<pre><code><span><span class="va">Xname</span> <span class="op">=</span> <span class="st">"SIS"</span></span></code></pre>
<p>For the <strong>XH</strong> component, the <strong>SIS</strong>
module implements a basic system of differential equations, that is
often called the <strong>SIS</strong> compartment model (see Figure 1).
This vignette describes the model and its implementation in
<strong><code>ramp.xds.</code></strong> For a more mathematical
introduction, see <a href="https://faculty.washington.edu/smitdave/malaria_theory/sis.html" target="_blank" class="external-link"><strong>Malaria Theory</strong> – SIS Dynamics</a></p>
<hr>
<div class="float">
<img src="SIS.png" alt="Figure 1: A Diagram of the SIS Model"><div class="figcaption">
<strong>Figure 1</strong>: A Diagram of the SIS
Model</div>
</div>
<hr>
<p>At basic setup, the <strong>SIS</strong> module with defaults is
specified like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dd-harp.github.io/ramp.xds/">ramp.xds</a></span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xds_setup.html">xds_setup</a></span><span class="op">(</span>Xname <span class="op">=</span> <span class="st">"SIS"</span><span class="op">)</span> </span></code></pre></div>
<hr>
<div class="section level2">
<h2 id="basic-dynamics">Basic Dynamics<a class="anchor" aria-label="anchor" href="#basic-dynamics"></a>
</h2>
<p>The following describes the notation and basic setup, including
variable and parameter names.</p>
<div class="section level3">
<h3 id="the-compartment-model">The Compartment Model<a class="anchor" aria-label="anchor" href="#the-compartment-model"></a>
</h3>
<p>A population is subdivided into susceptible (<span class="math inline">\(S\)</span>) and infected and infectious (<span class="math inline">\(I\)</span>) individuals, where the total
population is <span class="math inline">\(H = S+I.\)</span></p>
<ul>
<li><p>We let <span class="math inline">\(h\)</span> denote the force of
infection (FoI).</p></li>
<li><p>We let <span class="math inline">\(r\)</span> denote the
clearance rate for infections.</p></li>
</ul>
<p>The dynamics are described by a pair of equations:</p>
<p><span class="math display">\[
\begin{array}{rl}
\frac{dS}{dt} &amp;= -hS + rI  \\
\frac{dI}{dt} &amp;= h S  - rI  
\end{array}
\]</span></p>
<p>If <span class="math inline">\(H\)</span> is constant, then one of
these equations is redundant, and we need only compute:</p>
<p><span class="math display">\[
\frac{dI}{dt} = h (H-I) - rI
\]</span></p>
<p>The model here has been implemented in the
<strong><code>ramp.xds</code></strong> modular framework that handles
human demography, exposure, infectiousness, and diagnostics and
detection.</p>
<p>In the <strong><code>ramp.xds</code></strong> module, <span class="math inline">\(H\)</span> is a variable, so we compute <span class="math inline">\(dH/dt,\)</span> and <span class="math inline">\(dI/dt\)</span> includes additional terms that
describe demographic changes.</p>
</div>
<div class="section level3">
<h3 id="exposure-and-b">Exposure and <span class="math inline">\(b\)</span><a class="anchor" aria-label="anchor" href="#exposure-and-b"></a>
</h3>
<p>The module handles exposure through the standard interface (see <a href="Exposure.html">Exposure</a>). In a nutshell:</p>
<ul>
<li><p><span class="math inline">\(E(t)\)</span>: the daily EIR is
computed for each population stratum</p></li>
<li><p><span class="math inline">\(b\)</span> is a basis prameter in the
<strong>SIS</strong> module describing the probability of getting
infected by an infectious bite</p></li>
<li>
<p><span class="math inline">\(h\)</span> is the daily FoI,
<code>foi</code> (or what Ross called the <em>happenings</em> rate):</p>
<ul>
<li><p>it is computed in <code>Exposure</code> as <span class="math inline">\(h = F_h(b, E)\)</span></p></li>
<li><p>By default, the FoI assumes the number of bites per persion is
Poisson, so the FoI is linearly proportional to the EIR: <span class="math inline">\(h = b E\)</span></p></li>
</ul>
</li>
</ul>
<p>For more, including advanced setup options, see <a href="Exposure.html%5D">Exposure</a></p>
</div>
<div class="section level3">
<h3 id="infectiousness-c">Infectiousness: <span class="math inline">\(c\)</span><a class="anchor" aria-label="anchor" href="#infectiousness-c"></a>
</h3>
<p>Infected humans are not fully infectious. We assume that the fraction
of bloodmeals on infectious humans that infect a mosquito is <span class="math inline">\(c.\)</span> The blood feeding and transmission
interface uses biting weights and availability, so we compute the
infectious density of a stratum: <span class="math display">\[F_I = c
I.\]</span></p>
<p>If there is a single population stratum, then<br><span class="math display">\[\kappa = \frac {cI} H\]</span></p>
</div>
<div class="section level3">
<h3 id="diagnostics-and-detection">Diagnostics and Detection<a class="anchor" aria-label="anchor" href="#diagnostics-and-detection"></a>
</h3>
<p>The probability a human would <em>test positive</em> is denoted <span class="math inline">\(q\)</span>, so while true prevalence is <span class="math display">\[x=I/H,\]</span> observed prevalence would be
<span class="math display">\[x_q=qI/H.\]</span> The model includes three
parameters for detection by light microscopy, RDT or PCR:</p>
<ul>
<li><p><code>q_lm</code> - the probability of detecting parasites by
light microscopy</p></li>
<li><p><code>q_rdt</code> - the probability of detecting parasites by
rapid diagnostic test</p></li>
<li><p><code>q_pcr</code> - the probability of detecting parasites by
PCR</p></li>
</ul>
<p>We note that in this model, the observed PR is a linear function of
the true PR.</p>
</div>
<div class="section level3">
<h3 id="basic-setup">Basic Setup<a class="anchor" aria-label="anchor" href="#basic-setup"></a>
</h3>
<p>During basic setup, the parameters are assigned the following default
values:</p>
<ul>
<li><p><code>b=0.55</code></p></li>
<li><p><code>r=1/180</code></p></li>
<li><p><code>c=0.15</code></p></li>
<li><p><code>q_lm=0.8</code></p></li>
<li><p><code>q_rdt=0.8</code></p></li>
<li><p><code>q_pcr=0.9</code></p></li>
</ul>
<p>To inspect the parameters, use <code>get_XH_pars.</code> We already
set up <code>mod</code> using the default values:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_XH_pars.html">get_XH_pars</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">r</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.005555556</span></span></code></pre>
<p>To overwrite the defaults at setup, pass a named list to
<code>xds_setup.</code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xds_setup.html">xds_setup</a></span><span class="op">(</span>Xname <span class="op">=</span> <span class="st">"SIS"</span>, XHoptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>r<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">200</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_XH_pars.html">get_XH_pars</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span><span class="op">$</span><span class="va">r</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.005</span></span></code></pre>
<p>To change a parameter value after setup, pass a named list to
<code>change_XH_pars.</code></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/change_XH_pars.html">change_XH_pars</a></span><span class="op">(</span><span class="va">mod</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>r<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_XH_pars.html">get_XH_pars</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">$</span><span class="va">r</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.01</span></span></code></pre>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="mass-treatment">Mass Treatment<a class="anchor" aria-label="anchor" href="#mass-treatment"></a>
</h2>
<p>The module includes a port to simulate mass treatment. In the SIS
model, mass treatment increases the clearance rate from <span class="math inline">\(r\)</span> to <span class="math inline">\(r +
\xi(t)\)</span>. After curing an infection, in this model, the humans
become susceptible to infection again.</p>
<p><span class="math display">\[
\dot{I} = h (H-I)  - \left(r+\xi\left(t\right)\right) I
\]</span></p>
<p>During basic set up, the function returns no effect: <span class="math inline">\(\xi(t)=0\)</span>. Configuring a mass treatment
function is handled as an advanced setup option in
<code>ramp.control</code> (see <a href="https://dd-harp.github.io/ramp.control/articles/MassTreatment.html" class="external-link"><code>ramp.control</code>::Mass
Treatment</a>)</p>
<ul>
<li>
<p><span class="math inline">\(\xi(t)\)</span> is either called
<code>mda(t)</code> or <code>msat(t)</code>: functions implementing mass
treatment</p>
<ul>
<li><p>The function <code>mda(t)</code> implements mass drug
administration</p></li>
<li><p>The function <code>msat(t)</code> implements mass screen and
treat using detection parameters (see above)</p></li>
</ul>
</li>
<li><p>Setup for mass treatment is an advanced option in
<code>ramp.control</code></p></li>
</ul>
<p>To read more, see <a href="https://dd-harp.github.io/ramp.control/articles/MassTreatment.html" class="external-link"><code>ramp.control</code>::Mass
Treatment</a></p>
</div>
<div class="section level2">
<h2 id="human-demography">Human Demography<a class="anchor" aria-label="anchor" href="#human-demography"></a>
</h2>
<p>The implementation of the model was generalized to consider human (or
host) vital dynamics.</p>
<ul>
<li><p>The population birth rate, <span class="math inline">\(B(t,
H)\)</span></p></li>
<li><p>A constant per-capita rate, <span class="math inline">\(\mu.\)</span> The model does not include a
parameter to describe disease-induced mortality</p></li>
</ul>
<p><span class="math display">\[
\frac{dH}{dt} = B(t, H) - \mu H
\]</span> These demographic changes in <span class="math inline">\(H\)</span> require us to update the derivatives
for <span class="math inline">\(S\)</span> and <span class="math inline">\(I.\)</span> Since newborns are susceptible, we
get:</p>
<p><span class="math display">\[
\frac{dS}{dt} = B(t, H) - h S + r I  - \mu S  
\]</span></p>
<p>The dynamics for infected individuals are:</p>
<p><span class="math display">\[
\frac{dI}{dt} = h S - r I  - \mu I  
\]</span> Once again, since <span class="math inline">\(H=S+I,\)</span>
one of these equations is redundant. We compute <span class="math inline">\(dH/dt\)</span> and <span class="math inline">\(dI/dt.\)</span></p>
<p>In <code>ramp.demog</code>, we have implemented a generalized system
called <em>principled stratification</em> making it possible model
aging, migration, and dynamical exchanges among strata. After setup, all
these dynamics are combined in a single demographic matrix <span class="math inline">\(D\)</span>. The implementation is thus more
general:</p>
<p><span class="math display">\[
\dot{H} = B(t, H) - D \cdot H
\]</span></p>
<p>By default, the model is implemented with static population
dynamics:</p>
<ul>
<li><p><span class="math inline">\(B(t,H)\)</span> or
<code>B(t,H) = 0</code>: a function describing the population birth
rate</p></li>
<li><p><span class="math inline">\(D\)</span> or
<code>D_matrix=0,</code> where <span class="math inline">\(0\)</span> is
a matrix of zeros.</p></li>
</ul>
<p>Other functions can be configured as advanced options in
<code>ramp.demog.</code></p>
</div>
<div class="section level2">
<h2 id="the-sis-module">The <code>SIS</code> Module<a class="anchor" aria-label="anchor" href="#the-sis-module"></a>
</h2>
<div class="section level3">
<h3 id="variables">Variables<a class="anchor" aria-label="anchor" href="#variables"></a>
</h3>
<p>The module has two variables:</p>
<ul>
<li>
<p><span class="math inline">\(H\)</span> or <code>H</code> is human
population density, a vector of length <code>nStrata</code></p>
<ul>
<li><p>Since human population size, <span class="math inline">\(H,\)</span> has effects on the blood feeding
interface, its value must be assigned during setup as
<code>HPop=...</code></p></li>
<li><p>The parameter <code>nStrata</code> is set to
<code>length(HPop)</code></p></li>
<li><p>There is a function to change <span class="math inline">\(H\)</span> called <code>change_H</code></p></li>
</ul>
</li>
<li>
<p><span class="math inline">\(I\)</span> or <code>I</code> is the
density of infected humans, a vector of length <code>nStrata</code></p>
<ul>
<li><p>The default initial value is <span class="math inline">\(I=1\)</span></p></li>
<li><p>The function to change the initial values of <span class="math inline">\(I\)</span> are called by
<code>change_XH_inits</code></p></li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="the-derivatives">The Derivatives<a class="anchor" aria-label="anchor" href="#the-derivatives"></a>
</h3>
<p>The derivatives computed by <code>dXHdt.SIS</code> are equivalent
to:</p>
<p><span class="math display">\[
\begin{array}{rl}
\dot{H} &amp;= B(t, H) - D \cdot H \\
\dot{I} &amp;= h (H-I)  - \left(r+\xi\left(t\right)\right) I - D \cdot I
\end{array}
\]</span></p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Here we run a simple example with 3 population strata at equilibrium.
We use <code>ramp.xds::setup_XH</code> to set up parameters, and
<code><a href="../reference/setup_XH_inits.html">ramp.xds::setup_XH_inits</a></code> to set the initial values. We
configure a <code>trace</code> function to force the EIR.</p>
<p>Users interested in more technical details should read <a href="ex_534.html">our fully worked multi-patch example</a>.</p>
<p>First, we define the size of three population strata:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, <span class="fl">250</span><span class="op">)</span></span>
<span><span class="va">nStrata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">H</span><span class="op">)</span> </span></code></pre></div>
<p>We use the use the default model of human demography with no births
or deaths.</p>
<p>Next, we define the parameter values for all three strata as a named
list:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.55</span>, <span class="va">nStrata</span><span class="op">)</span> </span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="va">nStrata</span><span class="op">)</span> </span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">200</span>, <span class="va">nStrata</span><span class="op">)</span></span></code></pre></div>
<p>To use these values to build our model, we create a named list:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Xo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b<span class="op">=</span><span class="va">b</span>, c<span class="op">=</span><span class="va">c</span>, r<span class="op">=</span><span class="va">r</span><span class="op">)</span></span></code></pre></div>
<p>We want to set up the model in a way that tests the software. We want
to set values of the EIR and, knowing what the answer should be, show
that we get them back. First, we set the values of the FoI, and then we
compute the EIR:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">foi</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">/</span><span class="fl">365</span> </span>
<span><span class="va">eir</span> <span class="op">&lt;-</span> <span class="va">foi</span><span class="op">/</span><span class="va">b</span> </span></code></pre></div>
<p>The equilibrium values we should get back after running the equations
to steady state are <span class="math inline">\(I = H h
/(h+r)\)</span></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">I_eq</span> <span class="op">=</span> <span class="va">H</span><span class="op">*</span><span class="va">foi</span><span class="op">/</span><span class="op">(</span><span class="va">foi</span><span class="op">+</span><span class="va">r</span><span class="op">)</span> </span>
<span><span class="va">I_eq</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  35.39823 261.43791 155.44041</span></span></code></pre>
<p>First, we use <code>xds_setup</code> and next, we do it the long
way</p>
<div class="section level3">
<h3 id="using-setup">Using Setup<a class="anchor" aria-label="anchor" href="#using-setup"></a>
</h3>
<p>To set up the model, we simply do this:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/xds_setup_eir.html">xds_setup_eir</a></span><span class="op">(</span><span class="va">eir</span>, Xname<span class="op">=</span><span class="st">"SIS"</span>, HPop<span class="op">=</span><span class="va">H</span>, XHoptions <span class="op">=</span> <span class="va">Xo</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">test_SIS</span></span></code></pre></div>
<p>To solve it, we do this:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/xds_solve.html">xds_solve</a></span><span class="op">(</span><span class="va">test_SIS</span><span class="op">)</span><span class="op">-&gt;</span> <span class="va">test_SIS</span> </span></code></pre></div>
<p>We plot the prevalence over time:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clrs</span> <span class="op">=</span> <span class="fu">viridisLite</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">turbo</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/xds_plot_PR.html">xds_plot_PR</a></span><span class="op">(</span><span class="va">test_SIS</span>, clr<span class="op">=</span><span class="va">clrs</span><span class="op">)</span></span></code></pre></div>
<p><img src="human_sis_files/figure-html/unnamed-chunk-12-1.png" class="r-plt" alt="" width="672"></p>
<p>If we set the initial values of <span class="math inline">\(I\)</span> to the steady state values, the
variables shouldn’t change at all. To change the values, we simply add
them to the list</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_SIS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/change_XH_inits.html">change_XH_inits</a></span><span class="op">(</span><span class="va">test_SIS</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>I<span class="op">=</span><span class="va">I_eq</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/xds_solve.html">xds_solve</a></span><span class="op">(</span><span class="va">test_SIS</span><span class="op">)</span><span class="op">-&gt;</span> <span class="va">test_SIS</span> </span>
<span><span class="fu"><a href="../reference/xds_plot_PR.html">xds_plot_PR</a></span><span class="op">(</span><span class="va">test_SIS</span>, clr<span class="op">=</span><span class="va">clrs</span><span class="op">)</span></span></code></pre></div>
<p><img src="human_sis_files/figure-html/unnamed-chunk-13-1.png" class="r-plt" alt="" width="672"></p>
<p>Or we can use the <code>get_XH_out</code> function to get the values
of the orbits. This gets the return values and pulls of the the values
of <span class="math inline">\(I\)</span> at the last time step:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_XH_out.html">get_XH_out</a></span><span class="op">(</span><span class="va">test_SIS</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">XH2</span></span>
<span><span class="va">I_last</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">XH2</span><span class="op">$</span><span class="va">I</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">I_last</span></span></code></pre></div>
<pre><code><span><span class="co">##               4        5        6</span></span>
<span><span class="co">## [366,] 35.39823 261.4379 155.4404</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">XH2</span><span class="op">$</span><span class="va">I</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="va">I_eq</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="another-test">Another Test<a class="anchor" aria-label="anchor" href="#another-test"></a>
</h3>
<p>If we set <span class="math inline">\(I(0) = 0\)</span>, the simple
model has a closed form solution:</p>
<p><span class="math display">\[
I(t) = H (1-e^{-(h+r) t}) \frac{h}{h+r}
\]</span> We can reset the initial conditions and solve the system of
differential equations:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_SIS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/change_XH_inits.html">change_XH_inits</a></span><span class="op">(</span><span class="va">test_SIS</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/xds_solve.html">xds_solve</a></span><span class="op">(</span><span class="va">test_SIS</span><span class="op">)</span><span class="op">-&gt;</span> <span class="va">test_SIS</span> </span>
<span><span class="va">Itest</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_XH_out.html">get_XH_out</a></span><span class="op">(</span><span class="va">test_SIS</span>, <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">I</span> </span>
<span><span class="fu"><a href="../reference/xds_plot_PR.html">xds_plot_PR</a></span><span class="op">(</span><span class="va">test_SIS</span>, clr<span class="op">=</span><span class="va">clrs</span><span class="op">)</span></span></code></pre></div>
<p><img src="human_sis_files/figure-html/unnamed-chunk-16-1.png" class="r-plt" alt="" width="672"></p>
<p>…and we can compute the exact solutions for the same values of <span class="math inline">\(t\)</span>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_XH_out.html">get_XH_out</a></span><span class="op">(</span><span class="va">test_SIS</span>, <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">time</span></span>
<span><span class="va">It</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">366</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">ss</span> <span class="op">=</span> <span class="va">H</span><span class="op">*</span><span class="va">foi</span><span class="op">/</span><span class="op">(</span><span class="va">r</span><span class="op">+</span><span class="va">foi</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">It</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">H</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">r</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">foi</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">foi</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">foi</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">r</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The summing over all the squared differences is less than <span class="math inline">\(10^{-6}.\)</span></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">It</span><span class="op">-</span><span class="va">Itest</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-6</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David L. Smith, Sean L. Wu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
