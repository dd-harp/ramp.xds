<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Macdonald's Model • ramp.xds</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Macdonald's Model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ramp.xds</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99-3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/GettingStarted.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/BasicSetup.html">Basic Setup</a></li>
    <li><a class="dropdown-item" href="../articles/modular_forms.html">Modular Forms</a></li>
    <li><a class="dropdown-item" href="../articles/Exposure.html">Exposure</a></li>
    <li><a class="dropdown-item" href="../articles/Contributing.html">Contributing</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-adult-mosquitoes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Adult Mosquitoes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-adult-mosquitoes">
<li><a class="dropdown-item" href="../articles/adult_RM.html">Macdonald's Model</a></li>
    <li><a class="dropdown-item" href="../articles/RM-dts-Mosquito.html">Ross-Macdonald - discrete time</a></li>
    <li><a class="dropdown-item" href="../articles/adult_GeRM.html">Generalized Ross-Macdonald model</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-immature-mosquitoes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Immature Mosquitoes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-immature-mosquitoes">
<li><a class="dropdown-item" href="../articles/aqua_trace.html">Emergence (the trivial module)</a></li>
    <li><a class="dropdown-item" href="../articles/aqua_basic.html">basicL</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-human-host" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Human / Host</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-human-host">
<li><a class="dropdown-item" href="../articles/human_sis.html">SIS model</a></li>
    <li><a class="dropdown-item" href="../articles/human_hmoi.html">MoI hybrid model</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dd-harp/ramp.xds/"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Macdonald's Model</h1>
            <h3 data-toc-skip class="subtitle">A Delay Differential
Equation for Adult Mosquito Infection Dynamics</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/ramp.xds/blob/v0.99-3-beta/vignettes/adult_RM.Rmd" class="external-link"><code>vignettes/adult_RM.Rmd</code></a></small>
      <div class="d-none name"><code>adult_RM.Rmd</code></div>
    </div>

    
    
<p>This module called <code>macdonald</code> was included in
<strong><code>ramp.xds</code></strong> for historical reasons. In this
form, the model is difficult to extend because of problems formulating
the delay. The model, as presented here, has fixed parameter values. It
can not be extended with <em>forcing.</em> To address these problems, we
have developed a fully extensible delay differential equation model that
extends <code>macdonald,</code> the generalized, non-autonomous
Ross-Macdonald module <code>GeRM.</code></p>
<div class="section level2">
<h2 id="differential-equations">Differential Equations<a class="anchor" aria-label="anchor" href="#differential-equations"></a>
</h2>
<div class="section level3">
<h3 id="macdonalds-model">Macdonald’s Model<a class="anchor" aria-label="anchor" href="#macdonalds-model"></a>
</h3>
<p>Macdonald’s model for the sporozoite rate, published in 1952<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The analysis of the sporozoite rate. Macdonald G (1952).
Trop Dis Bull 49(6):569-86.&lt;/p&gt;"><sup>1</sup></a> has played
an important role in studies of malaria. Later that same year, Macdonald
introduced a formula for the basic reproductive rate, now called <span class="math inline">\(R_0.\)</span><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The analysis of equilibrium in malaria. Macdonald G
(1952). Trop Dis Bull 49(9):813-29.&lt;/p&gt;"><sup>2</sup></a> Macdonald gives credit to his colleague
Armitage for the mathematics. Armitage’s paper would be published the
next year,<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;A note on the epidemiology of malaria. Armitage P
(1953). Trop Dis Bull 50(10):890-2&lt;/p&gt;"><sup>3</sup></a> but that paper does not present the model
as a system of differential equations.</p>
<p>A simple system of differential equations that is consistent with
Macdonald’s model for the sporozoite rate has three parameters and one
term:</p>
<ul>
<li><p>the human blood feeding rate, <span class="math inline">\(a\)</span></p></li>
<li><p>the extrinsic incubation period, <span class="math inline">\(\tau\)</span></p></li>
<li><p>the mosquito death rate, <span class="math inline">\(g\)</span>;
or the probability of surviving one day, <span class="math inline">\(p=e^{-g}\)</span>, so <span class="math inline">\(g=-\ln p\)</span></p></li>
<li><p>the fraction of bites on humans that infect a mosquito, <span class="math inline">\(\kappa\)</span></p></li>
</ul>
<p>Let <span class="math inline">\(y\)</span> denote the fraction of
mosquitoes that are infected. The dynamics are given by: <span class="math display">\[\frac{dy}{dt} = a \kappa (1-y) - g y\]</span> Let
<span class="math inline">\(z\)</span> denote the fraction of mosquitoes
that are infectious. The model is a delay differential equation. Let
<span class="math inline">\(y_\tau\)</span> denote the value of <span class="math inline">\(y\)</span> at time <span class="math inline">\(t-\tau.\)</span> If the parameters and terms are
constant, then:<br><span class="math display">\[\frac{dz}{dt} = e^{-g\tau} a \kappa
(1-y_\tau) - g z\]</span> The model has a steady state for the fraction
infected: <span class="math display">\[\bar y = \frac{a \kappa} {a
\kappa + g}\]</span> The fraction infectious, also called the sporozoite
rate, is <span class="math display">\[\bar z = \frac{a \kappa} {a \kappa
+ g}e^{-g\tau}.\]</span> Macdonald used <span class="math inline">\(p\)</span> so his formula was: <span class="math display">\[\bar z = \frac{a \kappa} {a \kappa -\ln
p}e^{-p\tau}\]</span></p>
<p>To generate the formula for <span class="math inline">\(R_0,\)</span>
Macdonald introduces another variable and three additional
parameters:</p>
<ul>
<li><p>the ratio of mosquitoes to humans, <span class="math inline">\(m\)</span></p></li>
<li><p>the rate infections clear, <span class="math inline">\(r\)</span></p></li>
<li><p>the fraction of infectious bites that infect a human, <span class="math inline">\(b\)</span></p></li>
</ul>
<p>The fraction of infected and infectious humans, <span class="math inline">\(x,\)</span> is given by the equation:</p>
<p><span class="math display">\[\frac{dx}{dt} = m a z (1-y) - r
x\]</span> and the model assumes that <span class="math inline">\(\kappa
= x.\)</span> The formula for <span class="math inline">\(R_0\)</span>
in this system is: <span class="math display">\[R_0 = \frac{m b a^2}{gr}
e^{-g\tau} = \frac{m b a^2}{(-\ln p)r} e^{-p\tau}\]</span> In this form,
the model is difficult to use or extend.</p>
</div>
<div class="section level3">
<h3 id="aron-may">Aron &amp; May<a class="anchor" aria-label="anchor" href="#aron-may"></a>
</h3>
<p>The mosquito module in <strong><code>ramp.xds</code></strong> called
<code>macdonald</code> is based on a model first published in 1982 by
Joan Aron and Robert May<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;The population dynamics of malaria. In &lt;em&gt;The
Population Dynamics of Infectious Diseases: Theory and
Applications,&lt;/em&gt; R. M. Anderson, ed. (Springer US), pp. 139–179. &lt;a href="https://link.springer.com/chapter/10.1007/978-1-4899-2901-3_5" target="_blank" class="external-link"&gt;online&lt;/a&gt;&lt;/p&gt;'><sup>4</sup></a>. It includes state variables for total
mosquito density <span class="math inline">\(M\)</span>, infected
mosquito density <span class="math inline">\(Y\)</span>, and infectious
mosquito density <span class="math inline">\(Z\)</span>. In this model,
the blood feeding rate is split into an overall blood feeding rate,
<span class="math inline">\(f\)</span>, and the human fraction, <span class="math inline">\(q\)</span> such that <span class="math display">\[a=fq.\]</span> The Aron &amp; May’s equations
are: <span class="math display">\[\begin{array}{rl}
\frac{dM}{dt} &amp;= \Lambda(t) - g M \\
\frac{dY}{dt} &amp;= fq\kappa(M-Y) - g Y \\
\frac{dZ}{dt} &amp;= e^{-g\tau}fq\kappa_\tau(M_\tau-Y_\tau) - g Z \\
\end{array}\]</span></p>
</div>
<div class="section level3">
<h3 id="delay-differential-equations">Delay Differential Equations<a class="anchor" aria-label="anchor" href="#delay-differential-equations"></a>
</h3>
<p>The module called <code>macdonald</code> has been extended beyond the
Aron &amp; May formulation to include spatial dynamics and parity. To
formulate the spatial model, a spatial domain is sub-divided into a set
of patches. Variable and parameter names do not change, but they can now
represent vectors of length <span class="math inline">\(n_p.\)</span> To
formulate the <em>demographic matrix,</em> denoted <span class="math inline">\(\Omega,\)</span> that describes mosquito
mortality, emigration, and other loss from the system. We let <span class="math inline">\(\sigma\)</span> denote the emigration rate and
<span class="math inline">\(\cal K\)</span> the mosquito dispersal
matrix. We also introduce a parameter, <span class="math inline">\(\mu\)</span> to model the fraction of mosquitoes
that are lost to emigration from each patch. <span class="math display">\[\Omega = \mbox{diag} \left(g\right) +
\left(\mbox{diag} \left(1-\mu\right)  - \cal K\right) \cdot \mbox{diag}
\left(\sigma\right)
\]</span></p>
<div class="section level4">
<h4 id="dynamics">Dynamics<a class="anchor" aria-label="anchor" href="#dynamics"></a>
</h4>
<p><span class="math display">\[\begin{array}{rl}
\dot{M} &amp; = \Lambda - \Omega\cdot M  \\
\dot{P} &amp; = \mbox{diag}(f) \cdot (M-P) -  \Omega \cdot P\\
\dot{Y} &amp; = \mbox{diag}(fq\kappa) \cdot (M-Y) - \Omega \cdot Y \\
\dot{Z} &amp; =
\dot{Z} = e^{-\Omega \tau} \cdot \mbox{diag}(fq\kappa_{t-\tau}) \cdot
(M_{t-\tau}-Y_{t-\tau}) - \Omega \cdot Z
\end{array}
\]</span></p>
</div>
</div>
<div class="section level3">
<h3 id="ordinary-differential-equations">Ordinary Differential Equations<a class="anchor" aria-label="anchor" href="#ordinary-differential-equations"></a>
</h3>
<p>We note that the module <code>SI</code> provides a reasonably simple
approximating model that has no delay, but in computing <span class="math inline">\(fqZ,\)</span> it includes mortality and dispersal
that would have occurred during the EIP: <span class="math display">\[
Z = e^{-\Omega \tau} \cdot Y
\]</span> The implementation of <code>SI</code> is similar in spirit to
the simple model presented in Smith &amp; McKenzie (2004)<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Smith, D.L., Ellis McKenzie, F. Statics and dynamics of
malaria infection in Anopheles mosquitoes. Malar J 3, 13 (2004). &lt;a href="https://doi.org/10.1186/1475-2875-3-13" target="_blank" class="external-link"&gt;online&lt;/a&gt;&lt;/p&gt;'><sup>5</sup></a>. in that mortality and
dispersal over the EIP is accounted for, but the time lag is not. While
transient dynamics of the ODE model will not equal the DDE model, they
have the same equilibrium values, and so for numerical work requiring
finding equilibrium points, the faster ODE model can be safely
substituted.</p>
</div>
</div>
<div class="section level2">
<h2 id="equilibrium-solutions">Equilibrium solutions<a class="anchor" aria-label="anchor" href="#equilibrium-solutions"></a>
</h2>
<p>There are two logical ways to begin solving the non-trivial
equilibrium. The first assumes <span class="math inline">\(\Lambda\)</span> is known, which implies good
knowledge of mosquito ecology. The second assumes <span class="math inline">\(Z\)</span> is known, which implies knowledge of
the biting rate on the human population. We show both below.</p>
<div class="section level3">
<h3 id="starting-with-lambda">Starting with <span class="math inline">\(\Lambda\)</span><a class="anchor" aria-label="anchor" href="#starting-with-lambda"></a>
</h3>
<p>Given <span class="math inline">\(\Lambda\)</span> we can solve:</p>
<p><span class="math display">\[
M = \Omega^{-1} \cdot \Lambda
\]</span> Then given <span class="math inline">\(M\)</span> we set <span class="math inline">\(\dot{Y}\)</span> to zero and factor out <span class="math inline">\(Y\)</span> to get:</p>
<p><span class="math display">\[
Y = (\mbox{diag}(fq\kappa) + \Omega)^{-1} \cdot \mbox{diag}(fq\kappa)
\cdot M
\]</span> We set <span class="math inline">\(\dot{Z}\)</span> to zero to
get:</p>
<p><span class="math display">\[
Z = \Omega^{-1} \cdot e^{-\Omega \tau} \cdot \mbox{diag}(fq\kappa) \cdot
(M-Y)
\]</span></p>
<p>Because the dynamics of <span class="math inline">\(P\)</span> are
independent of the infection dynamics, we can solve it given <span class="math inline">\(M\)</span> as:</p>
<p><span class="math display">\[
P = (\Omega + \mbox{diag}(f))^{-1} \cdot \mbox{diag}(f) \cdot M
\]</span></p>
</div>
<div class="section level3">
<h3 id="starting-with-z">Starting with <span class="math inline">\(Z\)</span><a class="anchor" aria-label="anchor" href="#starting-with-z"></a>
</h3>
<p>It is more common that we start from an estimate of <span class="math inline">\(Z\)</span>, perhaps derived from an estimated EIR
(entomological inoculation rate). Given <span class="math inline">\(Z\)</span>, we can calculate the other state
variables and <span class="math inline">\(\Lambda\)</span>. For
numerical implementation, note that <span class="math inline">\((e^{-\Omega\tau})^{-1} =
e^{\Omega\tau}\)</span>.</p>
<p><span class="math display">\[
M-Y = \mbox{diag}(1/fq\kappa) \cdot (e^{-\Omega\tau})^{-1} \cdot \Omega
\cdot Z
\]</span></p>
<p><span class="math display">\[
Y = \Omega^{-1} \cdot \mbox{diag}(fq\kappa) \cdot (M-Y)
\]</span></p>
<p><span class="math display">\[
M = (M - Y) + Y
\]</span></p>
<p><span class="math display">\[
\Lambda = \Omega \cdot M
\]</span> We can use the same equation for <span class="math inline">\(P\)</span> as above.</p>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dd-harp.github.io/ramp.xds/">ramp.xds</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://R-Forge.R-project.org/projects/expm/" class="external-link">expm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/" class="external-link">deSolve</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>Here we show an example of starting and solving a model at
equilibrium. Please note that this only runs this adult mosquito model
and that most users should read <a href="ex_534.html">our fully worked
example</a> to run a full simulation.</p>
<div class="section level3">
<h3 id="ross-macdonald">Ross-Macdonald<a class="anchor" aria-label="anchor" href="#ross-macdonald"></a>
</h3>
<p><span class="math display">\[
\begin{array}{rl}
\frac{\textstyle{dy}}{\textstyle{dt}} &amp; = a \kappa \left(1
-y  \right) - g y \\
\frac{\textstyle{dz}}{\textstyle{dt}} &amp; = e^{-g\tau} q \kappa_\tau
\left[1 - y_\tau \right] - g z
\end{array}
\]</span></p>
</div>
<div class="section level3">
<h3 id="the-long-way">The long way<a class="anchor" aria-label="anchor" href="#the-long-way"></a>
</h3>
<p>Here we set up some parameters for a simulation with 3 patches.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HPop</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">nPatches</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">20</span>, <span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">10</span>, <span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="va">eip</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="va">nu</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span></span>
<span><span class="va">eggsPerBatch</span> <span class="op">&lt;-</span> <span class="fl">30</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MYZo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>f<span class="op">=</span><span class="va">f</span>,q<span class="op">=</span><span class="va">q</span>,g<span class="op">=</span><span class="va">g</span>,sigma<span class="op">=</span><span class="va">sigma</span>,mu<span class="op">=</span><span class="va">mu</span>,eip<span class="op">=</span><span class="va">eip</span>,nu<span class="op">=</span><span class="va">nu</span>,eggsPerBatch<span class="op">=</span><span class="va">eggsPerBatch</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nPatches</span>, <span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="va">calK</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="va">calK</span><span class="op">[</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">calK</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">calK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">calK</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Omega</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_Omega_xde.html">compute_Omega_xde</a></span><span class="op">(</span><span class="va">g</span>, <span class="va">sigma</span>, <span class="va">mu</span>, <span class="va">calK</span><span class="op">)</span></span>
<span><span class="va">Upsilon</span> <span class="op">&lt;-</span> <span class="fu">expm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/expm/man/expm.html" class="external-link">expm</a></span><span class="op">(</span><span class="op">-</span><span class="va">Omega</span> <span class="op">*</span> <span class="va">eip</span><span class="op">)</span></span></code></pre></div>
<p>Now we set up the parameter environment with the correct class using
<code>ramp.xds::make_parameters_MYZ_RM_xde,</code> noting that we will
be solving as an <code>ode.</code></p>
<p>Now we set the values of <span class="math inline">\(\kappa\)</span>
and <span class="math inline">\(\Lambda\)</span> and solve for the
equilibrium values.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kappa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.075</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span><span class="va">Xo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>kappa<span class="op">=</span><span class="va">kappa</span><span class="op">)</span></span>
<span><span class="va">Lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">Lo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Lambda<span class="op">=</span><span class="va">Lambda</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Omega_inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">Omega</span><span class="op">)</span></span>
<span><span class="va">M_eq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">Omega_inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Lambda</span><span class="op">)</span></span>
<span><span class="va">P_eq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">nPatches</span><span class="op">)</span> <span class="op">+</span> <span class="va">Omega</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">nPatches</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">M_eq</span><span class="op">)</span></span>
<span><span class="va">Y_eq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">f</span><span class="op">*</span><span class="va">q</span><span class="op">*</span><span class="va">kappa</span><span class="op">)</span> <span class="op">+</span> <span class="va">Omega</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">f</span><span class="op">*</span><span class="va">q</span><span class="op">*</span><span class="va">kappa</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">M_eq</span><span class="op">)</span></span>
<span><span class="va">Z_eq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">Omega_inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Upsilon</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">f</span><span class="op">*</span><span class="va">q</span><span class="op">*</span><span class="va">kappa</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">M_eq</span> <span class="op">-</span> <span class="va">Y_eq</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MYZo</span><span class="op">$</span><span class="va">M</span><span class="op">=</span><span class="va">M_eq</span></span>
<span><span class="va">MYZo</span><span class="op">$</span><span class="va">P</span><span class="op">=</span><span class="va">P_eq</span></span>
<span><span class="va">MYZo</span><span class="op">$</span><span class="va">Y</span><span class="op">=</span><span class="va">Y_eq</span></span>
<span><span class="va">MYZo</span><span class="op">$</span><span class="va">Z</span><span class="op">=</span><span class="va">Z_eq</span></span></code></pre></div>
<p>We use <code>ramp.xds::make_inits_MYZ_RM_xde</code> to store the
initial values. These equations have been implemented to compute <span class="math inline">\(\Upsilon\)</span> dynamically, so we attach
<code>Upsilon</code> as initial values:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_xds_object_template.html">make_xds_object_template</a></span><span class="op">(</span><span class="st">"dde"</span>, <span class="st">"mosy"</span>, <span class="va">nPatches</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_MYZpar.html">setup_MYZpar</a></span><span class="op">(</span><span class="st">"macdonald"</span>, <span class="va">params</span>, <span class="fl">1</span>, <span class="va">MYZo</span><span class="op">)</span>  </span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_MYZinits.html">setup_MYZinits</a></span><span class="op">(</span><span class="va">params</span>, <span class="fl">1</span>, <span class="va">MYZo</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_Xpar.html">setup_Xpar</a></span><span class="op">(</span><span class="st">"trivial"</span>, <span class="va">params</span>, <span class="fl">1</span>, <span class="va">Xo</span><span class="op">)</span> </span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_Xinits.html">setup_Xinits</a></span><span class="op">(</span><span class="va">params</span>, <span class="va">HPop</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_Lpar.html">setup_Lpar</a></span><span class="op">(</span><span class="st">"trivial"</span>, <span class="va">params</span>, <span class="fl">1</span>, <span class="va">Lo</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_Linits.html">setup_Linits</a></span><span class="op">(</span><span class="va">params</span>, <span class="fl">1</span>, <span class="va">Lo</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_Hpar_static.html">setup_Hpar_static</a></span><span class="op">(</span><span class="va">params</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We set the indices with <code><a href="../reference/make_indices.html">ramp.xds::make_indices</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_indices.html">make_indices</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/change_calK.html">change_calK</a></span><span class="op">(</span><span class="va">calK</span>, <span class="va">params</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span><span class="op">$</span><span class="va">Lambda</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">Lambda</span></span>
<span><span class="va">params</span><span class="op">$</span><span class="va">kappa</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">kappa</span> </span></code></pre></div>
<p>Then we can set up the initial conditions vector and use
<code><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">deSolve::ode</a></code> to solve the model. Normally these values
would be computed within <code>ramp.xds::xDE_diffeqn</code>. Here, we
set up a local version:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y0</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_MYZinits.html">get_MYZinits</a></span><span class="op">(</span><span class="va">params</span>, <span class="fl">1</span><span class="op">)</span> </span>
<span><span class="va">y0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">y0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MBionomics.html">MBionomics</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">y0</span>,<span class="va">params</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dMYZdt_local</span> <span class="op">=</span> <span class="va">func</span><span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/dMYZdt.html">dMYZdt</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/dede.html" class="external-link">dede</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y0</span>, times <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">50</span>, <span class="va">dMYZdt_local</span>, parms<span class="op">=</span><span class="va">params</span>, </span>
<span>                    method <span class="op">=</span> <span class="st">'lsoda'</span><span class="op">)</span> </span>
<span><span class="va">out1</span> <span class="op">&lt;-</span> <span class="va">out</span></span></code></pre></div>
<p>The output is plotted below. The flat lines shown here is a
verification that the steady state solutions that we computed above
match the steady states computed by solving the equations:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">=</span> <span class="va">out</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">params</span><span class="op">$</span><span class="va">MYZpar</span><span class="op">$</span><span class="va">M_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'M_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">params</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">params</span><span class="op">$</span><span class="va">MYZpar</span><span class="op">$</span><span class="va">P_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'P_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">params</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">params</span><span class="op">$</span><span class="va">MYZpar</span><span class="op">$</span><span class="va">Y_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Y_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">params</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">[</span><span class="va">params</span><span class="op">$</span><span class="va">MYZpar</span><span class="op">$</span><span class="va">Z_ix</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Z_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">params</span><span class="op">$</span><span class="va">nPatches</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">out</span>, id.vars <span class="op">=</span> <span class="st">'time'</span><span class="op">)</span></span>
<span><span class="va">out</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Component"</span>, <span class="st">"Patch"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/tstrsplit.html" class="external-link">tstrsplit</a></span><span class="op">(</span><span class="va">variable</span>, <span class="st">'_'</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">out</span><span class="op">[</span>, <span class="va">variable</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">out</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">Patch</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">Component</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="adult_RM_files/figure-html/unnamed-chunk-12-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="setup-utilities">Setup Utilities<a class="anchor" aria-label="anchor" href="#setup-utilities"></a>
</h3>
<p>In the vignette above, we set up a function to solve the differential
equation. We hope this helps the end user to understand how
<code>ramp.xds</code> works under the hood, but the point of
<code>ramp.xds</code> is to lower the costs of building, analyzing, and
using models. The functionality in <code>ramp.xds</code> can handle this
case – we can set up and solve the same model using built-in setup
utilities. Learning to use these utilities makes it very easy to set up
other models without having to learn some internals.</p>
<p>To set up a model with the parameters above, we make three list with
the named parameters and their values. We also attach to the list the
initial values we want to use, if applicable. For the Ross-Macdonald
adult mosquito model, we attach the parameter values:</p>
<p>Each one of the dynamical components has a configurable
<em>trivial</em> algorithm that computes no derivatives, but passes its
output as a parameter (see <code>human-trivial.R</code>. To configure
<code>Xpar,</code> we attach the values of <code>kappa</code> to a
list:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Xo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>kappa <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.075</span>, <span class="fl">0.025</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Similarly, we configure the <em>trivial</em> algorithm for aquatic
mosquitoes (see <code>aquatic-trivial.R</code>).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Lo</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To set up the model, we call <code>xds_setup</code> with</p>
<ul>
<li><p><code>nPatches</code> is set to 3</p></li>
<li><p><code>MYZname</code> is set to “macdonald” to run the
Ross-Macdonald model for adult mosquitoes; to pass our options, we write
<code>MYZopts = MYZo</code>; and finally, the dispersal matrix
<code>calK</code> is passed as <code>calK=calK</code></p></li>
<li><p><code>Xname</code> is set to “trivial” to run the trivial module
for human infection dynamics</p></li>
<li><p><code>Lname</code> is set to “trivial” to run the trivial module
aquatic mosquitoes</p></li>
</ul>
<p>Otherwise, setup takes care of all the internals:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/xds_setup.html">xds_setup</a></span><span class="op">(</span>MYZname <span class="op">=</span> <span class="st">"macdonald"</span>, Xname <span class="op">=</span> <span class="st">"trivial"</span>, Lname <span class="op">=</span> <span class="st">"trivial"</span>,  </span>
<span>    nPatches<span class="op">=</span><span class="fl">3</span>, calK<span class="op">=</span><span class="va">calK</span>, membership <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, </span>
<span>    residence <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, HPop <span class="op">=</span> <span class="va">HPop</span>,</span>
<span>    MYZopts <span class="op">=</span> <span class="va">MYZo</span>, Xopts <span class="op">=</span> <span class="va">Xo</span>, Lopts <span class="op">=</span> <span class="va">Lo</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">MYZeg</span></span></code></pre></div>
<p>Now, we can solve the equations using <code>xds_solve</code> and
compare the output to what we got above. If they are identical, the two
objects should be identical, so can simply add the absolute value of
their differences:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/xds_solve.html">xds_solve</a></span><span class="op">(</span><span class="va">MYZeg</span>, Tmax<span class="op">=</span><span class="fl">50</span>, dt<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">MYZeg</span> </span>
<span><span class="va">out2</span> <span class="op">&lt;-</span> <span class="va">MYZeg</span><span class="op">$</span><span class="va">outputs</span><span class="op">$</span><span class="va">orbits</span><span class="op">$</span><span class="va">deout</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out1</span><span class="op">-</span><span class="va">out2</span><span class="op">)</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span> </span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">out2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span>,</span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">M_eq</span>, <span class="va">P_eq</span>, <span class="va">Y_eq</span>, <span class="va">Z_eq</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;         [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]     [,8]</span></span>
<span><span class="co">#&gt; [1,] 157.868 123.4518 178.6802 140.3517 98.87622 155.0578 48.09598 27.56429</span></span>
<span><span class="co">#&gt;          [,9]    [,10]    [,11]    [,12]</span></span>
<span><span class="co">#&gt; [1,] 41.03339 24.96933 13.31699 25.75651</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
