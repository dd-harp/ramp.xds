<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The XH Component • ramp.xds</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The XH Component">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ramp.xds</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.3-0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/GettingStarted.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/BasicSetup.html">Basic Setup</a></li>
    <li><a class="dropdown-item" href="../articles/Working.html">Working with the Model Object</a></li>
    <li><a class="dropdown-item" href="../articles/ex_534.html">The 5-3-4 Model</a></li>
    <li><a class="dropdown-item" href="../articles/Delays.html">Delay Equations</a></li>
    <li><a class="dropdown-item" href="../articles/Forcing.html">Ports &amp; Junctions</a></li>
    <li><a class="dropdown-item" href="../articles/DTS.html">Discrete Time Systems</a></li>
    <li><a class="dropdown-item" href="../articles/TraceFunctions.html">Functions</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-interfaces" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Interfaces</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-interfaces">
<li><a class="dropdown-item" href="../articles/modular_forms.html">Modular Forms</a></li>
    <li><a class="dropdown-item" href="../articles/EggLaying.html">Habitats &amp; Mosquito Ecology</a></li>
    <li><a class="dropdown-item" href="../articles/BloodFeeding.html">Blood Feeding &amp; Transmission</a></li>
    <li><a class="dropdown-item" href="../articles/Exposure.html">Exposure</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-human-host" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Human / Host</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-human-host">
<li><a class="dropdown-item" href="../articles/XH-interface.html">The XH Component</a></li>
    <li><a class="dropdown-item" href="../articles/human_sis.html">SIS model</a></li>
    <li><a class="dropdown-item" href="../articles/human_hmoi.html">MoI hybrid model</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-adult-mosquitoes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Adult Mosquitoes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-adult-mosquitoes">
<li><a class="dropdown-item" href="../articles/MY-interface.html">The MY Component</a></li>
    <li><a class="dropdown-item" href="../articles/adult_RM.html">Macdonald's Model</a></li>
    <li><a class="dropdown-item" href="../articles/RM-dts-Mosquito.html">Ross-Macdonald - discrete time</a></li>
    <li><a class="dropdown-item" href="../articles/adult_GeRM.html">Generalized Ross-Macdonald model</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-immature-mosquitoes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Immature Mosquitoes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-immature-mosquitoes">
<li><a class="dropdown-item" href="../articles/L-interface.html">The L Component</a></li>
    <li><a class="dropdown-item" href="../articles/aqua_trace.html">Emergence (the trivial module)</a></li>
    <li><a class="dropdown-item" href="../articles/aqua_basic.html">basicL</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dd-harp/ramp.xds/"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>The XH Component</h1>
            <h3 data-toc-skip class="subtitle">Models for Human or
Vertebrate Host Infection, Immuno-Epidemiology &amp; Demography</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/ramp.xds/blob/main/vignettes/XH-interface.Rmd" class="external-link"><code>vignettes/XH-interface.Rmd</code></a></small>
      <div class="d-none name"><code>XH-interface.Rmd</code></div>
    </div>

    
    
<p>The <strong>XH</strong> component was designed for human malaria
epidemiology, defined in a narrow sense to include exposure, infection
dynamics, immunity, disease, infectiousness, diagnostics and detection.
In the broader sense, human malaria epidemiology also includes malaria
transmission dynamics, but these aspects are handled by other parts of
<strong><code>ramp.xds.</code></strong></p>
<p>The <strong>XH</strong> component also handles models for the
demography, infection dynamics, and immunity for vertebrate hosts other
mosquito-borne diseases.</p>
<p>A library of <strong>XH</strong> modules can be found in <a href="https://dd-harp.github.io/ramp.library/" class="external-link"><strong><code>ramp.library</code></strong></a>.</p>
<p>This vignette takes a deep dive into the design and structure of the
<strong>XH</strong> component. It is useful for anyone who wants to
learn more about how the code works.</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <strong>XH</strong> component was designed to handle human
demography and malaria epidemiology; and more broadly, the population
dynamics of a vertebrate host population and the pathogen’s infection
dynamics and immuno-epidemiology.</p>
<p>…</p>
</div>
<div class="section level2">
<h2 id="required-functions">Required Functions<a class="anchor" aria-label="anchor" href="#required-functions"></a>
</h2>
<p>Each <strong>XH</strong> module includes 19 required functions and
some optional ones.</p>
<p>Some of these required functions are <code>S3</code> class functions
in <a href="https://github.com/dd-harp/ramp.xds/blob/main/R/human-XH-interface.R" target="_blank" class="external-link">human-XH-interface.R</a>. Others are defined for each
module.</p>
<p>One good example is the <code>SIS</code> module, posted in the
<code>ramp.xds</code> github repository <a href="https://github.com/dd-harp/ramp.xds/blob/main/R/human-XH-SIS.R" target="_blank" class="external-link">human-XH-SIS.R</a>.</p>
<p>The required functions deal with various tasks for model building and
solving: constructing the <strong>XH</strong> model object; the
dynamics; the parameters; the variables and their initial values;
computing terms and standard outputs; and consistency checks. Optional
outputs include other metrics; functions to compute steady states; and
module specific functions to visualize the outputs.</p>
<p>Each module is defined by a string, generically called
<code>Xname,</code> that identifies the module: <em>e.g.</em>
<code>SIS.</code></p>
<div class="section level3">
<h3 id="dynamics">Dynamics<a class="anchor" aria-label="anchor" href="#dynamics"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<p>The dynamics are defined by at least one of the following is
required, depending on whether the model family is a system of
differential equations or a discrete time system:</p>
<ul>
<li><p><code>dXHdt.Xname</code> :: differential equations are defined by
a function that computes the derivatives. In <code>ramp.xds</code> these
are encoded in a function called <code>dXHdt.</code> The function is set
up to be solved by <code><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">deSolve::ode</a></code> or
<code>deSolve::dede.</code></p></li>
<li><p><code>Update_XHt.Xname</code> :: discrete time systems are
defined by the function that updates the state variables in one time
step. In <code>ramp.xds</code> these are encoded in a function called
<code>Update_XHt</code> that computes and returns the <strong>state
variables.</strong> The forms mimic the ones used for differential
equations.</p></li>
</ul>
</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="xh-model-object">XH Model Object<a class="anchor" aria-label="anchor" href="#xh-model-object"></a>
</h2>
<p>Each module has a pair of functions that set up a structured list
called the <strong>XH</strong> model object. The object is a list that
is assigned to a <code>class</code> that dispatches the <code>S3</code>
functions described below. It is a compound list, where some of the
sub-lists are assigned their own <code>class</code> that dispatch other
<code>S3</code> functions.</p>
<ol start="2" style="list-style-type: decimal">
<li>
<p><code>make_XH_obj_Xname</code> :: returns a structured list
called an <strong>XH</strong> model object:</p>
<ul>
<li><p>the parameter values are stored by name</p></li>
<li><p><code>class(XH_obj)</code> = <code>Xname</code></p></li>
<li><p>the indices for the model variables are stored as
<code>XH_obj$ix</code></p></li>
<li><p>the initial values are stored as
<code>XH_obj$inits</code></p></li>
<li>
<p>ports are added and set to their <code>null</code> values:</p>
<ul>
<li><p>a function to model the population birth rate</p></li>
<li><p>a demographic matrix for deaths, aging, and more</p></li>
<li><p>functions to model mass treatment</p></li>
</ul>
</li>
<li><p>anything else that is needed can be configured here</p></li>
</ul>
</li>
<li><p><code>setup_XH_obj.Xname</code> is a wrapper that calls
<code>make_XH_obj_Xname</code> and (for the <span class="math inline">\(i^{th}\)</span> species) attaches the object as
<code>xds_obj$XH_obj[[i]]</code></p></li>
</ol>
<div class="section level3">
<h3 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h3>
<ol start="4" style="list-style-type: decimal">
<li><p><code>change_XH_pars.Xname</code> changes the values of some
parameters. It is designed to be used after setup. New parameter values
are passed by name in a list called <code>options.</code></p></li>
<li><p><code>get_XH_pars.Xname</code> is a utility to inspect the values
of the parameters.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="variables">Variables<a class="anchor" aria-label="anchor" href="#variables"></a>
</h3>
<p>Since the <strong>XH</strong> component is one of three, a function
sets up the indices for all the variables in a model.</p>
<p>Two other functions use those indices: one pulls the variables from
the state variable vector <span class="math inline">\(y\)</span>; the
other one pulls the variables by name from an output matrix returned by
<code>xds_solve.</code></p>
<p>After pulling, both functions return the variables in by name in a
list to make it easy to inspect or use.</p>
<ol start="6" style="list-style-type: decimal">
<li><p><code>setup_XH_ix.Xname</code> - is the function that assigns an
index to each variable in the model, and stores it as
<code>xds_obj$XH_obj[[i]]$ix.</code> The indices are returned as a named
list.</p></li>
<li><p><code>get_XH_vars.Xname</code> - retrieves the value of variables
from the state variables vector <span class="math inline">\(y\)</span>
at a point in time and returns the values by name in a list; the
function gets called by <code>dXHdt</code> and by
<code>change_XH_inits</code> and it can be useful in other
contexts.</p></li>
<li><p><code>parse_XH_orbits.Xname</code> - this function is like
<code>get_XH_vars</code> but it parses the matrix of outputs returned by
<code>xds_solve.</code></p></li>
</ol>
</div>
<div class="section level3">
<h3 id="initial-values">Initial Values<a class="anchor" aria-label="anchor" href="#initial-values"></a>
</h3>
<p>A set of functions is sets up or changes the initial values for the
state variables.</p>
<ol start="9" style="list-style-type: decimal">
<li><p><code>make_XH_inits_Xname</code> - each model must include a
function that makes a set of initial values as a named list. This
function does not belong to any <code>S3</code> class, so it can take
any form. The function should supply default initial values for all the
variables. These can be overwritten by passing new initial values in
<code>options.</code></p></li>
<li><p><code>setup_XH_inits.Xname</code> - is a wrapper, that gets
called by <code>xds_setup</code> and that calls
<code>make_XH_inits_Xname.</code> The setup <code>options</code> are
passed to overwrite default values. The initial values are stored as
<code>XH_obj$inits.</code></p></li>
<li><p><code>change_XH_inits.Xname</code> - a utility to change the
initial values.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="dynamical-terms">Dynamical Terms<a class="anchor" aria-label="anchor" href="#dynamical-terms"></a>
</h3>
<p>These functions compute dynamical terms – the outputs passed to an
interface.</p>
<ol start="12" style="list-style-type: decimal">
<li><p><code>F_X.Xname</code> - compute the effective infectious density
of the vertebrate hosts. This gets computed and passed through the blood
feeding and transmission interface to compute <span class="math inline">\(\kappa.\)</span></p></li>
<li><p><code>F_H.Xname</code> - get the human/host population
density</p></li>
<li><p><code>F_infectivity.Xname</code> - compute the probability a host
will become infected by each infectious bite. This function gets called
by the function <code>Exposure,</code> a part of the blood feeding and
transmission interface that translates local and travel EIR into an
estimated FoI under a model of environmental heterogeneity.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="standard-outputs">Standard Outputs<a class="anchor" aria-label="anchor" href="#standard-outputs"></a>
</h3>
<p>Each module must output a few key quantities:</p>
<ol start="15" style="list-style-type: decimal">
<li><p><code>F_prevalence.Xname</code> - compute prevalence</p></li>
<li><p><code>F_ni.Xname</code> - compute net infectiousness (NI) for
each stratum. If <span class="math inline">\(F_X \rightarrow X\)</span>
and <span class="math inline">\(F_H \rightarrow H\)</span>, then <span class="math inline">\(F_{ni} \rightarrow X/H.\)</span> The function gets
called after solving, and the NI is attached as a term for inspection
and visualization.</p></li>
<li><p><code>HTC.Xname</code> - compute the human transmitting capacity.
This is used by functions in <strong><code>ramp.work</code></strong>
that compute threshold conditions.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="consistency-checks">Consistency Checks<a class="anchor" aria-label="anchor" href="#consistency-checks"></a>
</h3>
<p>Some modules in <strong><code>ramp.xds</code></strong> or
<strong><code>ramp.library</code></strong> have been included for
various reasons. Not all of those models are capable of being extended.
To help users avoid using models in ways that are not appropriate, we
developed two function classes:</p>
<ol start="18" style="list-style-type: decimal">
<li><p><code>skill_set_XH.Xname</code> :: describes model capabilities
and limitations</p></li>
<li><p><code>check_XH.Xname</code> :: at the end of
<code>xds_setup</code> and at the beginning of <code>xds_solve,</code>
this function gets run to ensure that some quantities have been properly
updated, and to see if anything has been added to a model that is not in
its skill set.</p></li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="optional-functions">Optional Functions<a class="anchor" aria-label="anchor" href="#optional-functions"></a>
</h2>
<p>The <strong>XH</strong> interface also sets up <code>S3</code>
classes for some optional functions, but these might not be appropriate
for all models. If a function is not in the <em>skill set</em> of the
module, then the limitation should be noted in the documentation of
<code>skill_set_XH.Xname</code> with information in the list.</p>
<div class="section level3">
<h3 id="optional-outputs">Optional Outputs<a class="anchor" aria-label="anchor" href="#optional-outputs"></a>
</h3>
<p>For malaria models, built in functions compute prevalence by various
diagnostics.</p>
<ul>
<li><p><code>F_pfpr_by_lm.Xname</code> :: output predicted prevalence by
light microscopy</p></li>
<li><p><code>F_pfpr_by_rdt.Xname</code> :: output predicted prevalence
by rapid diagnostic test</p></li>
<li><p><code>F_pfpr_by_pcr.Xname</code> :: output predicted prevalence
by PCR</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="steady-states">Steady States<a class="anchor" aria-label="anchor" href="#steady-states"></a>
</h3>
<p>Methods are defined to compute various steady states under static
parameter values.</p>
<ul>
<li><p><code>steady_state_X.Xname</code> :: pass the FoI and H and
computes steady states for the <strong>X</strong> component, if
appropriate.</p></li>
<li><p><code>steady_state_XH.Xname</code> :: pass the FoI and compute
states for the <strong>XH</strong> component, if appropriate.</p></li>
<li><p><code>steady_state_H.Xname</code> :: compute steady states for
the <strong>H</strong> component, if appropriate.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h3>
<p>Functions have been developed to plot the standard terms, but each
module can define its own method for plotting:</p>
<ul>
<li><p><code>xds_plot_XH.Xname</code> is a wrapper that calls
<code>xds_lines_X</code></p></li>
<li><p><code>xds_lines_XH.Xname</code> defines a default method for
plotting orbits</p></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David L. Smith, Sean L. Wu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
