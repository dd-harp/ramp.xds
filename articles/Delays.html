<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Delay Equations • ramp.xds</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Delay Equations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ramp.xds</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.6-0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/GettingStarted.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/BasicSetup.html">Basic Setup</a></li>
    <li><a class="dropdown-item" href="../articles/Working.html">Working with the Model Object</a></li>
    <li><a class="dropdown-item" href="../articles/ex_534.html">The 5-3-4 Model</a></li>
    <li><a class="dropdown-item" href="../articles/Delays.html">Delay Equations</a></li>
    <li><a class="dropdown-item" href="../articles/Forcing.html">Ports &amp; Junctions</a></li>
    <li><a class="dropdown-item" href="../articles/DTS.html">Discrete Time Systems</a></li>
    <li><a class="dropdown-item" href="../articles/TraceFunctions.html">Functions</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-interfaces" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Interfaces</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-interfaces">
<li><a class="dropdown-item" href="../articles/modular_forms.html">Modular Forms</a></li>
    <li><a class="dropdown-item" href="../articles/EggLaying.html">Habitats &amp; Mosquito Ecology</a></li>
    <li><a class="dropdown-item" href="../articles/BloodFeeding.html">Blood Feeding &amp; Transmission</a></li>
    <li><a class="dropdown-item" href="../articles/Exposure.html">Exposure</a></li>
    <li><a class="dropdown-item" href="../articles/MosquitoBionomics.html">Bionomics</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-human-host" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Human / Host</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-human-host">
<li><a class="dropdown-item" href="../articles/XH-interface.html">The XH Component</a></li>
    <li><a class="dropdown-item" href="../articles/human_sis.html">SIS model</a></li>
    <li><a class="dropdown-item" href="../articles/human_hmoi.html">MoI hybrid model</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-adult-mosquitoes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Adult Mosquitoes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-adult-mosquitoes">
<li><a class="dropdown-item" href="../articles/MY-interface.html">The MY Component</a></li>
    <li><a class="dropdown-item" href="../articles/adult_RM.html">Macdonald's Model</a></li>
    <li><a class="dropdown-item" href="../articles/RM-dts-Mosquito.html">Ross-Macdonald - discrete time</a></li>
    <li><a class="dropdown-item" href="../articles/adult_GeRM.html">Generalized Ross-Macdonald model</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-immature-mosquitoes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Immature Mosquitoes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-immature-mosquitoes">
<li><a class="dropdown-item" href="../articles/L-interface.html">The L Component</a></li>
    <li><a class="dropdown-item" href="../articles/aqua_trace.html">Emergence (the trivial module)</a></li>
    <li><a class="dropdown-item" href="../articles/aqua_basic.html">basicL</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dd-harp/ramp.xds/"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Delay Equations</h1>
            <h3 data-toc-skip class="subtitle">Computing Lagged Values
in a Modular Framework</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/ramp.xds/blob/main/vignettes/Delays.Rmd" class="external-link"><code>vignettes/Delays.Rmd</code></a></small>
      <div class="d-none name"><code>Delays.Rmd</code></div>
    </div>

    
    
<p>In this short vignette, we explain how
<strong><code>ramp.xds</code></strong> was designed to handle the
challenges of implementing delay differential equations.</p>
<hr>
<p><strong>Solving</strong></p>
<p>To solve systems of delay differential equations, we need to use
<code>deSolve::dede.</code> For ordinary differential equations, we use
<code>deSolve::ode.</code> Discrete time systems don’t use
<code>deSolve.</code> To handle all these differences, the
<code>xds_obj</code> includes two objects: <code>xds_obj$xds</code> and
<code>xds_obj$xde</code> that are used to dispatch functions that must
handle ordinary and delay equations and discrete time systems in
different ways.</p>
<hr>
<p><strong>Computing Lagged Values of Terms</strong></p>
<p>There was a design challenge for implementing modularity in systems
of delay differential equations. In modular software, a term can be
computed anywhere, but the lagged values of that term must be stored
somehow and retrieved in the function that computes the derivatives. The
design principle is to internalize the computation of terms with a lag.
The design solution involves the function
<code>deSolve::lagderiv.</code> To compute the value of any lagged term,
generically <span class="math inline">\(v,\)</span> a dummy variable is
added, <span class="math inline">\(V,\)</span> where <span class="math inline">\(dV/dt = v.\)</span> Indexing for dummy variables
is handled by the module. In computing the derivatives, the value
<code>lagderiv</code> for <span class="math inline">\(V(t-\tau)\)</span>
returns the value <span class="math inline">\(v(t-\tau).\)</span></p>
<p>Discrete time systems present a different challenge, but the same
principle gets applied. An object stores a many lagged values of the
variables or terms as needed.</p>
<p>The lagged values before runtime use initial values. (If you know a
better way to handle this, please write me!)</p>
<hr>
<div class="section level2">
<h2 id="a-lagged-value-example">A Lagged Value Example<a class="anchor" aria-label="anchor" href="#a-lagged-value-example"></a>
</h2>
<p>A model published by Aron and May in 1982 includes terms to describe
the dynamics of infected (<span class="math inline">\(Y\)</span>) and
infectious (<span class="math inline">\(Z\)</span>) mosquitoes. It is
system of delay differential equations. To write it down, we let the
subscript <span class="math inline">\(\tau\)</span> denote the value of
a quantity at time <span class="math inline">\(t-\tau;\)</span> for
example, <span class="math inline">\(Y_\tau = Y(t-\tau).\)</span></p>
<p><span class="math display">\[
\begin{array}{rl}
\frac{dY}{dt} &amp;= f q \kappa(M-Y) - g Y \\
\frac{dZ}{dt} &amp;= f q \kappa_\tau \left(M_\tau -Y_\tau \right) - g Z
\end{array}
\]</span></p>
<p>To implement this, we would need the value of <span class="math inline">\(\kappa_\tau\)</span> and of <span class="math inline">\(M_\tau\)</span>, and <span class="math inline">\(Y_\tau.\)</span> In the software implementation
<span class="math inline">\(M\)</span> and <span class="math inline">\(Y\)</span> are variables, so we can use
<code>deSolve::lagvalue,</code> but the value of <span class="math inline">\(\kappa\)</span> is computed and stored in
<code>Transmission.</code> One solution (let’s call it the external
design solution for lagged values) is to handle lagged terms when they
are computed, so <code>Transmission</code> would compute and store <span class="math inline">\(\kappa_\tau.\)</span></p>
<p>To extend the implementation to handle non-autonomous systems, we
must be able to handle time-varying bionomic parameters, where the
values of the parameters could be modified by weather, vector control,
or something else. This extended non-autonomous system is:</p>
<p><span class="math display">\[
\begin{array}{rl}
\frac{dY}{dt} &amp;= f q \kappa(M-Y) - g Y \\
\frac{dZ}{dt} &amp;= f_\tau q_\tau \kappa_\tau \left(M_\tau -Y_\tau
\right) - g Z
\end{array}
\]</span></p>
<p>To implement this, we would need to know <span class="math inline">\(f_\tau q_\tau \kappa_\tau.\)</span> In the
external design solution for lagged values, software would need to store
<span class="math inline">\(f_\tau\)</span> and <span class="math inline">\(q_\tau.\)</span> If those terms relied on other
variables, the computation and storage problem for lagged values would
proliferate.</p>
<p>The internal design solution for lagged values creates a dummy
variable, <span class="math inline">\(V\)</span>, where <span class="math display">\[dV/dt = f q \kappa.\]</span> In the module
implementation, the variable <span class="math inline">\(V\)</span> is
indexed in the same way as the other variables. It is computed in
<code>dMYdt</code> just like the other variables. In the function call,
<code><a href="https://rdrr.io/pkg/deSolve/man/timelags.html" class="external-link">deSolve::lagderiv</a></code> is called to retrieve the lagged value
<span class="math inline">\(f_\tau q_\tau \kappa_\tau\)</span> which is
the lagged derivative of the variable <code>V.</code></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David L. Smith, Sean L. Wu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
