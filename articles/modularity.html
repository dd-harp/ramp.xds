<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Nimble Model Building â€¢ ramp.xds</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Nimble Model Building">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ramp.xds</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1-0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/GettingStarted.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/BasicSetup.html">Basic Setup</a></li>
    <li><a class="dropdown-item" href="../articles/modular_forms.html">Modular Forms</a></li>
    <li><a class="dropdown-item" href="../articles/EggLaying.html">Habitats and Egg Laying</a></li>
    <li><a class="dropdown-item" href="../articles/BloodFeeding.html">Blood Feeding</a></li>
    <li><a class="dropdown-item" href="../articles/Exposure.html">Exposure</a></li>
    <li><a class="dropdown-item" href="../articles/Forcing.html">Ports &amp; Junctions</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-adult-mosquitoes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Adult Mosquitoes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-adult-mosquitoes">
<li><a class="dropdown-item" href="../articles/MY-interface.html">MY Interface</a></li>
    <li><a class="dropdown-item" href="../articles/adult_RM.html">Macdonald's Model</a></li>
    <li><a class="dropdown-item" href="../articles/RM-dts-Mosquito.html">Ross-Macdonald - discrete time</a></li>
    <li><a class="dropdown-item" href="../articles/adult_GeRM.html">Generalized Ross-Macdonald model</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-immature-mosquitoes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Immature Mosquitoes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-immature-mosquitoes">
<li><a class="dropdown-item" href="../articles/L-interface.html">L Interface</a></li>
    <li><a class="dropdown-item" href="../articles/aqua_trace.html">Emergence (the trivial module)</a></li>
    <li><a class="dropdown-item" href="../articles/aqua_basic.html">basicL</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-human-host" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Human / Host</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-human-host">
<li><a class="dropdown-item" href="../articles/XH-interface.html">XH Interface</a></li>
    <li><a class="dropdown-item" href="../articles/human_sis.html">SIS model</a></li>
    <li><a class="dropdown-item" href="../articles/human_hmoi.html">MoI hybrid model</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dd-harp/ramp.xds/"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Nimble Model Building</h1>
            <h3 data-toc-skip class="subtitle">Modular Dynamical Systems
&amp; Computatation for Malaria &amp; Other Mosquito-Transmitted
Pathogens</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/ramp.xds/blob/main/vignettes/modularity.Rmd" class="external-link"><code>vignettes/modularity.Rmd</code></a></small>
      <div class="d-none name"><code>modularity.Rmd</code></div>
    </div>

    
    
<p>This software supports nimble model building with functions to set
up, solve, and analyze dynamical systems models for mosquito ecology and
mosquito-borne pathogen transmission formulated as dynamical systems in
continuous or discrete time. The systems are naturally modular: an
intermediate step in developing a model for
<strong><code>ramp.xds</code></strong> is to rewrite the equations using
<a href="https://dd-harp.github.io/ramp.xds/articles/modularity.html">Modular
Forms</a>.</p>
<p>The mathematical framework and software have a modular design
developed around an algorithm to model mosquito blood feeding on
vertebrate hosts and parasite / pathogen transmission, including
patch-based spatial dynamics within a defined geographical domain. The
blood feeding algorithm provides a rigorous computational interface
linking dynamical components describing parasite/pathogen linking
infection dynamics in mosquito and vertebrate host populations. It
guarantees mathematical consistency in computing blood feeding rates and
habits and in allocating bites and blood meals with heterogeneous
vertebrate host population densities, including models with dynamically
changing availability of host populations or other vertebrate
animals.</p>
<p>The framework and software also support spatial models of mosquito
ecology through an algorithm that describes egg laying by adult
mosquitoes in aquatic habitats and emergence of adult mosquitoes. The
egg laying algorithm provides a rigorous interface linking dynamical
components describing adult mosquito populations in a set of spatial
patches and immature aquatic mosquito populations in a structured set of
aquatic habitats.</p>
<div class="section level2">
<h2 id="modularity">Modularity<a class="anchor" aria-label="anchor" href="#modularity"></a>
</h2>
<p>Dynamical systems models for malaria and other mosquito-borne
pathogens (MBPs) are naturally modular. Transmission dynamics involve
infection dynamics in populations of two different species of hosts: a
mosquito host, and a human or other vertebrate animal host. Parasite /
pathogen transmission occurs through blood feeding. The modular nature
of these systems can be emphasized by rewriting the equations using <a href="modular_forms.html">modular forms</a></p>
<p>Mosquito population density is a parameter in the Ross-Macdonald
model. Many dynamical systems describing transmission dynamics and
control for malaria and other MBPs include equations describing mosquito
ecology and population dynamics: volant adult and aquatic immature
mosquito sub-populations connected through egg-laying and emergence. The
equations describing these dynamics can be organized around blood
feeding (for transmission) or egg-laying and emergence (for mosquito
ecology).</p>
<p>In simple models, the assumptions about</p>
<hr>
<div class="float">
<img src="modularity.png" alt="Figure 1 A diagram of the core components in dynamical systems models of malaria: \cal L"><div class="figcaption">
<strong>Figure 1</strong> A diagram of the core
components in dynamical systems models of malaria: <span class="math inline">\(\cal L\)</span>
</div>
</div>
<hr>
<p>Dynamical systems for malaria and other MBPs have a broad set of
other features: spatial dynamics; human/host demography; heterogeneous
transmission; various forms of vector control; health interventions;
mosquito resource dynamics; malaria importation; and exogenous forcing
by weather.</p>
<hr>
<div class="float">
<img src="ModularGeneralized.png" alt="Modularity"><div class="figcaption">Modularity</div>
</div>
<div class="float">
<img src="RossMacdonald3b.png" alt="Ross"><div class="figcaption">Ross</div>
</div>
<p>In <code>ramp.xds,</code> the equations are solved by computing the
terms and the derivatives separately.</p>
<ul>
<li>
<p><code>Transmission(t,y,pars)</code> computes three terms required
to compute parasite transmission during blood feeding. These are stored
in the main model object <code>pars</code>:</p>
<ul>
<li><p><code>pars$beta</code> - a function that allocates infective
bites to human strata. In this case, <span class="math inline">\(\beta =
1/H\)</span></p></li>
<li><p><code>pars$NI</code> - a function <span class="math inline">\(F_X\)</span> computes the effective density. In
this case, <span class="math inline">\(F_X\)</span> returns <span class="math inline">\(cI\)</span></p></li>
<li><p><code>pars$fqZ</code> - a function <span class="math inline">\(F_fqZ\)</span> computes infective biting
density</p></li>
<li><p><code>pars$EIR</code> - the daily EIR is <span class="math inline">\(\beta \cdot fqZ\)</span></p></li>
<li><p><code>pars$FoI</code> - the daily FoI is <span class="math inline">\(F_h(EIR, b, pars\)</span>Xpar)$</p></li>
</ul>
</li>
<li><p><code>Exposure(t, y, pars)</code> computes the FoI from the EIR
under a model of exposure and stores it as
<code>pars$FoI</code></p></li>
</ul>
<p>So instead of developing models like <code>RMv1</code>, we have
implemented the code in the syle of <code>RMv2</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RMv2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span>,<span class="op">{</span></span>
<span>      <span class="va">pars</span> <span class="op">=</span> <span class="fu"><a href="../reference/Transmission.html">Transmission</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span></span>
<span>      <span class="va">pars</span> <span class="op">=</span> <span class="fu"><a href="../reference/Exposure.html">Exposure</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span></span>
<span>      <span class="va">dX</span> <span class="op">=</span> <span class="fu">dXdt</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span> </span>
<span>      <span class="va">dY</span> <span class="op">=</span> <span class="fu">dMYZdt</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span> </span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">dX</span>, <span class="va">dY</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-building-in-ramp-xds">Model building in ramp.xds<a class="anchor" aria-label="anchor" href="#model-building-in-ramp-xds"></a>
</h2>
<p>Models for mosquito borne pathogen transmission systems are naturally
modular, structured by vector life stage, host population strata, and by
the spatial locations (patches) at which transmission occurs (see figure
below).</p>
<p align="center">
<img src="modularity.png">&gt;
</p>
<p>Models in the ramp.xds framework are constructed from 3 dynamical
components:</p>
<ul>
<li>
<span class="math inline">\(\mathcal M\)</span>: adult mosquitoes,
whose dynamics are described by <span class="math inline">\(d\mathcal{M}/dt\)</span>
</li>
<li>
<span class="math inline">\(\mathcal{L}\)</span>: aquatic (immature)
mosquitoes, whose dynamics are described by <span class="math inline">\(d\mathcal{L}/dt\)</span>
</li>
<li>
<span class="math inline">\(\mathcal{X}\)</span>: human population,
whose dynamics are described by <span class="math inline">\(d\mathcal{X}/dt\)</span>
</li>
</ul>
<p>The combined state from these 3 components is the entire state of the
dynamical model, and their combined dynamics described by their
differential equations represents the full endogenous dynamics of the
system. In addition there are 2 more components which do not directly
contribute to the state of the model, but instead modify parameters and
compute intermediate quantities to represent external influences on the
system. These are:</p>
<ul>
<li>Exogenous forcing: weather, climate, unmodeled populations</li>
<li>Vector control: public health and mosquito control interventions
which affect the dynamical components</li>
</ul>
<p>There are also functions which handle the exchange of information
(flows) between the dynamical components and which couple their
dynamics. Bloodfeeding is the process by which adult mosquitoes seek out
and feed on blood hosts, and results in the quantities <span class="math inline">\(EIR\)</span> (entomological inoculation rate) and
<span class="math inline">\(\kappa\)</span>, the net infectiousness of
humans to mosquitoes, which couple the dynamics of <span class="math inline">\(\mathcal{M}\)</span> and <span class="math inline">\(\mathcal{X}\)</span>. Likewise emergence of new
adults from aquatic habitats and egg laying by adults into habitats
couples <span class="math inline">\(\mathcal{M}\)</span> and <span class="math inline">\(\mathcal{L}\)</span>.</p>
<p>The function <code><a href="../reference/xde_derivatives.html">ramp.xds::xde_derivatives</a></code> compute the
necessary quantities and returns a vector of derivatives of all state
variables which can be used to solve trajectories from a model in
ramp.xds. The program flow within this function is summarized by this
diagram:</p>
<p align="center">
<img src="xDEdiffeqn.png"></p>
<p>For more information, please read our <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1010684" class="external-link">research
article</a> describing the theory behind the model.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David L. Smith, Sean L. Wu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
