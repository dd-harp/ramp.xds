<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modular Forms for Disease Dynamics • ramp.xds</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Modular Forms for Disease Dynamics">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ramp.xds</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.98</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/GettingStarted.html">Getting Started with ramp.xds</a>
    </li>
    <li>
      <a href="../articles/Working.html">Working with Models in ramp.xds</a>
    </li>
    <li>
      <a href="../articles/TraceFunctions.html">Trace Functions</a>
    </li>
    <li>
      <a href="../articles/Understanding_ramp.xds.html">Understanding ramp.xds</a>
    </li>
    <li>
      <a href="../articles/modular_forms.html">Modular Forms for Disease Dynamics</a>
    </li>
    <li>
      <a href="../articles/ex_534.html">5-3-4 Spatial Example</a>
    </li>
    <li>
      <a href="../articles/spat_metric.html">Spatial Metrics</a>
    </li>
    <li>
      <a href="../articles/vc_lemenach.html">Vector Control Example</a>
    </li>
    <li>
      <a href="../articles/heterogeneous_transmission.html">Heterogeneous Transmission</a>
    </li>
    <li>
      <a href="../articles/Nimble.html">Nimble Model Building and Scaling Complexity</a>
    </li>
    <li>
      <a href="../articles/Contributing.html">Contributing</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Mosquito - Adult

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adult_RM.html">Ross-Macdonald model</a>
    </li>
    <li>
      <a href="../articles/RM-dts-Mosquito.html">Ross-Macdonald, discrete time</a>
    </li>
    <li>
      <a href="../articles/adult_GeRM.html">Generalized Ross-Macdonald model</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Mosquito - Aquatic

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/aqua_trace.html">Aquatic - Trivial (forced) model</a>
    </li>
    <li>
      <a href="../articles/aqua_basic.html">Basic Competition</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Human / Host

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/human_sis.html">SIS model</a>
    </li>
    <li>
      <a href="../articles/human_hmoi.html">MoI hybrid model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dd-harp/ramp.xds/" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Modular Forms for Disease Dynamics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dd-harp/ramp.xds/blob/main/vignettes/modular_forms.Rmd" class="external-link"><code>vignettes/modular_forms.Rmd</code></a></small>
      <div class="hidden name"><code>modular_forms.Rmd</code></div>

    </div>

    
    
<p>A <strong>modular form</strong> is a stylized way of writing down a
dynamical systems that emphasizes the structure of the underlying
process. The modular structure of <strong><code>ramp.xds</code></strong>
can be understood through the use of these forms. The forms we describe
here rewrite models so that they closely resemble their implementation
in <code>ramp.xds</code>, which makes it possible to relate written
equations and computed code.</p>
<div class="section level2">
<h2 id="a-standard-form">A Standard Form<a class="anchor" aria-label="anchor" href="#a-standard-form"></a>
</h2>
<p>A mathematical framework for building modular models of malaria
dynamics and control (and other mosquito-borne pathogens) was described
in <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1010684" target="_blank" class="external-link">Spatial Dynamics of Malaria Transmission</a>, and that
framework has been implemented in <code>ramp.xds.</code></p>
<p>There is no <em>standard form</em> for writing down systems of
differential equations, but many forms are used, depending on context.
For comparison, we writing down a system of equations that does not
emphasize the modularity, or <em>not a modular form.</em></p>
<p>To illustrate the modular form, we start with the
<em>Ross-Macdonald</em>-style model in Box 1.</p>
<hr>
<p><strong>Box 1: A Ross-Macdonald Model</strong></p>
<ul>
<li><p>Let the dependent variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">I(t)</annotation></semantics></math>
denote the density of infected humans, and the parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math>
the density of all humans</p></li>
<li><p>Let the dependent variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y(t)</annotation></semantics></math>
denote the density of infected mosquitoes, and the parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
the density of all mosquitoes</p></li>
<li><p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>
denote the fraction of bites by infective mosquitoes that infect a
human, and let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>r</mi><annotation encoding="application/x-tex">r</annotation></semantics></math>
denote the rate that infections clear</p></li>
<li><p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>
denote the fraction of blood meals on infectious humans infect a
mosquito, and let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>
denote the mosquito death rate</p></li>
<li><p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>f</mi><annotation encoding="application/x-tex">f</annotation></semantics></math>
denote the overall blood feeding rate, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>
the human fraction</p></li>
<li><p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>
denote the EIP.</p></li>
</ul>
<p>In this set of equations, we ignore the delay for sporogony, but we
count the mortality, so infections occur at the rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><msup><mi>e</mi><mrow><mo>−</mo><mi>g</mi><mi>τ</mi></mrow></msup><mi>f</mi><mi>q</mi><mi>Y</mi><mi>/</mi><mi>H</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">b e^{-g \tau} fqY/H.</annotation></semantics></math>
We assume that the daily FoI is linearly proportional to the daily EIR,
consistent with a Poisson model for exposure, so
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mi>b</mi><mi>E</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">h = bE.</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>d</mi><mi>I</mi><mi>/</mi><mi>d</mi><mi>t</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>b</mi><msup><mi>e</mi><mrow><mo>−</mo><mi>g</mi><mi>n</mi></mrow></msup><mi>f</mi><mi>q</mi><mfrac><mi>Y</mi><mi>H</mi></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo>−</mo><mi>I</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>r</mi><mi>I</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>d</mi><mi>Y</mi><mi>/</mi><mi>d</mi><mi>t</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>f</mi><mi>q</mi><mi>c</mi><mfrac><mi>I</mi><mi>H</mi></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><mi>M</mi><mo>−</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>g</mi><mi>Y</mi></mtd></mtr></mtable><annotation encoding="application/x-tex"> \begin{array}{rl}
dI/dt &amp;= b e^{-gn}fq \frac YH (H-I) - r I \\
dY/dt &amp;= fq c \frac IH (M-Y) - g Y
\end{array}</annotation></semantics></math></p>
<hr>
</div>
<div class="section level2">
<h2 id="in-modular-form">…in Modular Form<a class="anchor" aria-label="anchor" href="#in-modular-form"></a>
</h2>
<p>We illustrate by writing a Ross-Macdonald model in its modular form
(Figure 1). In the modular form, we identify the terms in one equation
that depend on the other variable. First, we focus on the equation
describing human infection dynamics. We note that it depends on a term
involving the variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">Y.</annotation></semantics></math>
The term is epidemiologically meaningful – it is called the force of
infection (FoI). We let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
denote the FoI:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mi>b</mi><msup><mi>e</mi><mrow><mo>−</mo><mi>g</mi><mi>n</mi></mrow></msup><mi>f</mi><mi>q</mi><mfrac><mi>Y</mi><mi>H</mi></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">h=b e^{-gn}fq \frac YH,</annotation></semantics></math></p>
<p>and now we can rewrite the equation</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>I</mi><mi>/</mi><mi>d</mi><mi>t</mi><mo>=</mo><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>H</mi><mo>−</mo><mi>I</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>r</mi><mi>I</mi></mrow><annotation encoding="application/x-tex"> 
dI/dt = h  (H-I) - r I
</annotation></semantics></math></p>
<p>Next, we isolate the equation describing mosquito infection dynamics,
we note that it depends on a term that we will call the net
infectiousness (NI).</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>κ</mi><mo>=</mo><mfrac><mi>X</mi><mi>H</mi></mfrac></mrow><annotation encoding="application/x-tex">\kappa = \frac XH</annotation></semantics></math></p>
<p>The term
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mi>c</mi><mi>I</mi></mrow><annotation encoding="application/x-tex"> X = c I</annotation></semantics></math>
is the density of infected humans, weighted by their infectiousness.</p>
<p>We note that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>q</mi><mi>κ</mi></mrow><annotation encoding="application/x-tex">fq\kappa</annotation></semantics></math>
is the FoI for mosquito infections, and now we can rewrite the equation
for mosquitoes:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>Y</mi><mi>/</mi><mi>d</mi><mi>t</mi><mo>=</mo><mi>f</mi><mi>q</mi><mi>κ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>M</mi><mo>−</mo><mi>Y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>g</mi><mi>Y</mi></mrow><annotation encoding="application/x-tex">
dY/dt = fq\kappa (M-Y) - g Y
</annotation></semantics></math></p>
<p>Since we also want to make this model extensible, we want to draw
attention to the term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">h.</annotation></semantics></math>
We note that the number of infective bites, per human, per day – called
the daily entomological inoculation rate (EIR) – is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><mi>f</mi><mi>q</mi><msup><mi>e</mi><mrow><mo>−</mo><mi>g</mi><mi>τ</mi></mrow></msup><mfrac><mi>Y</mi><mi>H</mi></mfrac></mrow><annotation encoding="application/x-tex">E = f q e^{-g\tau} \frac YH </annotation></semantics></math></p>
<p>We assume that exposure is Poisson distributed:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mi>b</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">h = b E</annotation></semantics></math></p>
<p>We emphasize that this is the same set</p>
<hr>
<div class="float">
<img src="RossMacdonald3b.png" alt="Figure 1 - Diagram of a Ross-Macdonald model in Box 1, rewritten in a modular form."><div class="figcaption">
<strong>Figure 1</strong> - Diagram of a
Ross-Macdonald model in Box 1, rewritten in a modular form.</div>
</div>
<hr>
</div>
<div class="section level2">
<h2 id="computation">Computation<a class="anchor" aria-label="anchor" href="#computation"></a>
</h2>
<p>To solve these equations, we need to write functions that compute the
derivatives. We are using the R package <code>deSolve.</code> A properly
formed derivative function implementing the</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RMv1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">pars</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pars</span>,<span class="op">{</span></span>
<span>      <span class="va">eir</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">g</span><span class="op">*</span><span class="va">n</span><span class="op">)</span><span class="op">*</span><span class="va">Y</span><span class="op">/</span><span class="va">H</span></span>
<span>      <span class="va">foi</span> <span class="op">=</span> <span class="va">b</span><span class="op">*</span><span class="va">eir</span></span>
<span>      <span class="va">kappa</span> <span class="op">=</span> <span class="va">c</span><span class="op">*</span><span class="va">I</span><span class="op">/</span><span class="va">H</span></span>
<span>      <span class="va">dX</span> <span class="op">=</span> <span class="va">foi</span><span class="op">*</span><span class="op">(</span><span class="va">H</span><span class="op">-</span><span class="va">I</span><span class="op">)</span> <span class="op">-</span> <span class="va">r</span><span class="op">*</span><span class="va">I</span></span>
<span>      <span class="va">dY</span> <span class="op">=</span> <span class="va">a</span><span class="op">*</span><span class="va">kappa</span><span class="op">*</span><span class="op">(</span><span class="va">M</span><span class="op">-</span><span class="va">Y</span><span class="op">)</span> <span class="op">-</span> <span class="va">g</span><span class="op">*</span><span class="va">Y</span> </span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">dX</span>, <span class="va">dY</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="full-modularity">Full Modularity<a class="anchor" aria-label="anchor" href="#full-modularity"></a>
</h2>
<p>For a longer discussion of modularity, see the vignette <a href="modularity.html">modularity</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Sean L. Wu, David L. Smith.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
